<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exponent Rules Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .quiz-container {
            transition: all 0.3s ease-in-out;
        }
        .result-item.correct {
            background-color: #f0fdf4;
            border-left-color: #22c55e;
        }
        .result-item.incorrect {
            background-color: #fef2f2;
            border-left-color: #ef4444;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.1em;
            background-color: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .question-prefix {
            font-weight: 500;
            flex-shrink: 0;
        }
        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 0.2em;
        }
        .numerator {
            border-bottom: 2px solid black;
            padding: 0 0.4em;
        }
        .denominator {
            padding: 0 0.4em;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-lg w-full max-w-4xl quiz-container">
        <div class="p-8 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800">1.1 Quiz Exponent Rules Retake</h1>
            <p class="text-gray-600 mt-2">Generate a new quiz anytime. Four-Function Calculator Allowed.</p>
        </div>

        <div id="quizContainer" class="p-8">
            <!-- The quiz form will be dynamically generated and inserted here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Quiz Results</h2>
            <div id="score" class="text-xl mb-6 font-semibold"></div>
            <div id="detailedResults" class="space-y-4"></div>
             <div class="mt-8 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="retakeQuizBtn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-transform transform hover:scale-105 w-full sm:w-auto">
                    Try This Quiz Again
                </button>
                <button id="generateNewBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-105 w-full sm:w-auto">
                    Generate New Quiz
                </button>
            </div>
        </div>
    </main>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        const resultsSection = document.getElementById('resultsSection');
        const scoreElement = document.getElementById('score');
        const detailedResultsElement = document.getElementById('detailedResults');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const generateNewBtn = document.getElementById('generateNewBtn');

        let currentQuestions = [];

        // --- UTILITY FUNCTIONS ---
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        // --- QUESTION GENERATORS ---
        function generateExponentQuestions() {
            const questions = [];

            // Section 1: Evaluate
            const base1a = getRandomInt(2, 5);
            questions.push({ type: 'eval', id: 'q1a', text: `<code>(-${base1a})<sup>2</sup></code>`, answer: Math.pow(base1a, 2).toString() });
            
            const base1b = getRandomInt(2, 4);
            questions.push({ type: 'eval', id: 'q1b', text: `<code>-${base1b}<sup>4</sup></code>`, answer: (-Math.pow(base1b, 4)).toString() });

            const pow1c = getRandomInt(15, 51) * 2 + 1; // odd power
            questions.push({ type: 'eval', id: 'q1c', text: `<code>(-1)<sup>${pow1c}</sup></code>`, answer: '-1' });

            const pow1d = getRandomInt(15, 51) * 2; // even power
            questions.push({ type: 'eval', id: 'q1d', text: `<code>(-1)<sup>${pow1d}</sup></code>`, answer: '1' });

            // Section 2: Simplify
            // a) Product rule: c1*x^p1 * c2*x^p2
            const c2a1 = getRandomInt(2, 6); const p2a1 = getRandomInt(2, 5);
            const c2a2 = getRandomInt(2, 6); const p2a2 = getRandomInt(2, 5);
            questions.push({ type: 'simplify', id: 'q2a', text: `<code>${c2a1}x<sup>${p2a1}</sup> &middot; ${c2a2}x<sup>${p2a2}</sup></code>`, answer: `${c2a1*c2a2}x^${p2a1+p2a2}` });

            // b) Quotient rule
            const c2b_d = getRandomInt(2, 5); const p2b_d = getRandomInt(2, 5); const q2b_d = getRandomInt(2, 5);
            const c_mult = getRandomInt(2, 5); const p_add = getRandomInt(1, 4); const q_add = getRandomInt(1, 4);
            const c2b_n = c2b_d * c_mult; const p2b_n = p2b_d + p_add; const q2b_n = q2b_d + q_add;
            questions.push({ type: 'simplify', id: 'q2b', 
                text: `<div class="fraction">
                           <span class="numerator"><code>${c2b_n}x<sup>${p2b_n}</sup>y<sup>${q2b_n}</sup></code></span>
                           <span class="denominator"><code>${c2b_d}x<sup>${p2b_d}</sup>y<sup>${q2b_d}</sup></code></span>
                       </div>`, 
                answer: `${c_mult}x^${p_add}y^${q_add}` 
            });

            // c) Power rule
            const c2c = getRandomInt(2, 4); const p2c1 = getRandomInt(2, 4); const p2c2 = getRandomInt(2, 4); const pow2c = getRandomInt(2, 3);
            questions.push({ type: 'simplify', id: 'q2c', text: `<code>(${c2c}x<sup>${p2c1}</sup>y<sup>${p2c2}</sup>)<sup>${pow2c}</sup></code>`, answer: `${Math.pow(c2c,pow2c)}x^${p2c1*pow2c}y^${p2c2*pow2c}` });

            // d) Combo rule
            const c2d_n1 = getRandomInt(2, 4); const p2d_n1 = 1; const q2d_n1 = getRandomInt(5, 9);
            const p2d_n2 = getRandomInt(2, 4); const q2d_n2 = 1;
            const c2d_d = c2d_n1; const p2d_d = p2d_n1 + p2d_n2; const q2d_d = getRandomInt(2, 5);
            const pow2d = 2;
            const final_q = (q2d_n1 + q2d_n2 - q2d_d) * pow2d;
            questions.push({ type: 'simplify', id: 'q2d', 
                text: `(&nbsp;<div class="fraction">
                           <span class="numerator"><code>${c2d_n1}xy<sup>${q2d_n1}</sup> &middot; x<sup>${p2d_n2}</sup>y</code></span>
                           <span class="denominator"><code>${c2d_d}x<sup>${p2d_d}</sup>y<sup>${q2d_d}</sup></code></span>
                       </div>&nbsp;)<sup>${pow2d}</sup>`, 
                answer: `y^${final_q}`
            });

            return questions;
        }

        // --- CORE QUIZ LOGIC ---
        function generateAndRenderQuiz() {
            currentQuestions = generateExponentQuestions();
            renderQuizForm(currentQuestions);
            quizContainer.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            window.scrollTo(0, 0);
        }

        function renderQuizForm(questions) {
            const q1 = questions.filter(q => q.type === 'eval');
            const q2 = questions.filter(q => q.type === 'simplify');
            const prefixes_a = ['a)', 'b)', 'c)', 'd)'];
            
            const q1HTML = q1.map((q, i) => `
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center">
                    <p class="flex items-center gap-4"><span class="question-prefix">${prefixes_a[i]}</span>${q.text}</p>
                    <input type="text" id="${q.id}" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
            `).join('<hr class="my-3 border-dashed">');
            
            const q2HTML = q2.map((q, i) => `
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center">
                    <p class="flex items-center gap-4"><span class="question-prefix">${prefixes_a[i]}</span>${q.text}</p>
                    <input type="text" id="${q.id}" class="w-full p-2 border border-gray-300 rounded-lg">
                 </div>
            `).join('<hr class="my-3 border-dashed">');

            quizContainer.innerHTML = `
                <form id="quizForm">
                    <div class="mb-10">
                        <h2 class="text-xl font-semibold text-gray-700 mb-6">1. Evaluate each expression:</h2>
                        <div class="space-y-3">${q1HTML}</div>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-700 mb-6">2. Fully simplify each expression using only positive exponents.</h2>
                        <div class="space-y-3">${q2HTML}</div>
                    </div>
                    <div class="mt-10 text-center">
                        <button type="submit" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg">Grade My Quiz</button>
                    </div>
                </form>
            `;
            document.getElementById('quizForm').addEventListener('submit', gradeQuiz);
        }
        
        const normalizeAnswer = (str) => {
            let s = str.replace(/\s+/g, '').replace(/\*/g, '').toLowerCase();
            if (s.match(/[a-z]/)) {
                const coeff = s.match(/^-?\d+/g) || ['1'];
                const vars = s.match(/[a-z]\^?-?\d*/g) || [];
                vars.sort();
                return coeff.concat(vars).join('');
            }
            return s;
        };
        
        function gradeQuiz(event) {
            event.preventDefault();
            let score = 0;
            let resultsHTML = '';
            
            currentQuestions.forEach(q => {
                const userInput = document.getElementById(q.id).value;
                const isCorrect = normalizeAnswer(userInput) === normalizeAnswer(q.answer);

                if (isCorrect) score++;

                resultsHTML += `<div class="result-item border-l-4 p-4 rounded-md ${isCorrect ? 'correct' : 'incorrect'}">
                    <div class="font-semibold text-gray-800 flex items-center gap-4">${q.text}</div>
                    <p class="mt-2 text-sm">Your answer: <span class="font-medium ${isCorrect ? 'text-green-700' : 'text-red-700'}">${userInput || '<i>No answer</i>'}</span></p>
                    ${!isCorrect ? `<p class="mt-1 text-sm">Correct answer: <span class="font-medium text-green-700">${q.answer}</span></p>` : ''}
                </div>`;
            });
            
            const totalQuestions = currentQuestions.length;
            const percentage = Math.round((score / totalQuestions) * 100);
            let scoreColor = percentage >= 80 ? 'text-green-600' : (percentage >= 60 ? 'text-yellow-600' : 'text-red-600');
            scoreElement.innerHTML = `Your Score: <span class="${scoreColor}">${score} out of ${totalQuestions} (${percentage}%)</span>`;
            detailedResultsElement.innerHTML = resultsHTML;
            quizContainer.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        // --- EVENT LISTENERS ---
        retakeQuizBtn.addEventListener('click', () => {
            renderQuizForm(currentQuestions);
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });
        generateNewBtn.addEventListener('click', generateAndRenderQuiz);
        document.addEventListener('DOMContentLoaded', generateAndRenderQuiz);
    </script>
</body>
</html>

