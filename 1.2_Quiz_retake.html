<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplifying Radicals Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .solution-box {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-lg w-full max-w-2xl">
        <div class="p-8 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800">Simplifying Radicals Practice</h1>
            <p class="text-gray-600 mt-2">Check your answer after each problem. Use 'sqrt()' or the &radic; button.</p>
        </div>

        <div id="quizContainer" class="p-8">
            <!-- The quiz question will be dynamically generated and inserted here -->
        </div>

    </main>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        let allQuestions = [];
        let currentQuestionIndex = 0;

        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);

        function insertSymbolAtCursor(inputId, textToInsert, cursorOffset) {
            const input = document.getElementById(inputId);
            if (!input) return;
            const startPos = input.selectionStart;
            const endPos = input.selectionEnd;
            input.value = input.value.substring(0, startPos) + textToInsert + input.value.substring(endPos);
            const newCursorPos = startPos + cursorOffset;
            input.focus();
            input.setSelectionRange(newCursorPos, newCursorPos);
        }

        function simplifyRadical(n) {
            if (n === 0) return { coeff: 0, rad: 1 };
            if (n < 0) return { coeff: NaN, rad: NaN }; // No real roots for negatives
            let coeff = 1;
            let rad = n;
            for (let i = Math.floor(Math.sqrt(n)); i > 1; i--) {
                if (rad % (i * i) === 0) {
                    coeff *= i;
                    rad /= (i * i);
                }
            }
            return { coeff, rad };
        }

        function generateQuestions() {
            allQuestions = [];
            const validPairs = [
                [4, 2], [4, 3], [4, 5], [4, 6], [4, 7], [4, 10], [4, 11], [4, 13], [4, 14], [4, 15], [4, 17], [4, 18], [4, 19], [4, 21], [4, 22],
                [9, 2], [9, 3], [9, 5], [9, 6], [9, 7], [9, 8],
                [16, 2], [16, 3], [16, 5],
                [25, 2], [25, 3],
                [36, 2],
            ];
            
            // Generate 3 simple radical problems
            const chosenPairs = shuffle(validPairs).slice(0, 3);
            chosenPairs.forEach(pair => {
                const radicand = pair[0] * pair[1];
                const simplified = simplifyRadical(radicand);
                allQuestions.push({
                    text: `&radic;<span style="text-decoration:overline;">&nbsp;${radicand}&nbsp;</span>`,
                    answer: `${simplified.coeff}sqrt(${simplified.rad})`,
                    solutionSteps: [
                        `Find the largest perfect square that divides ${radicand}. In this case, it is ${pair[0]}.`,
                        `Rewrite the radical as a product: &radic;(${pair[0]} &middot; ${pair[1]})`,
                        `Take the square root of the perfect square: &radic;${pair[0]} = ${Math.sqrt(pair[0])}.`,
                        `The final simplified form is ${Math.sqrt(pair[0])}&radic;${pair[1]}.`
                    ]
                });
            });

            // Generate 3 problems with variables
            for (let i = 0; i < 3; i++) {
                const pair = shuffle(validPairs)[0];
                const coeff_out = Math.sqrt(pair[0]);
                const rad_val = pair[1];
                const px_out = getRandomInt(1, 3);
                const py_out = getRandomInt(1, 3);
                const radicandNum = pair[0] * rad_val;
                const exp_x = px_out * 2;
                const exp_y = py_out * 2 + 1;
                allQuestions.push({
                    text: `&radic;<span style="text-decoration:overline;">&nbsp;${radicandNum}x<sup>${exp_x}</sup>y<sup>${exp_y}</sup>&nbsp;</span>`,
                    answer: `${coeff_out}x^${px_out}y^${py_out}sqrt(${rad_val}y)`,
                    solutionSteps: [
                        `Separate the number and each variable: &radic;${radicandNum} &middot; &radic;x<sup>${exp_x}</sup> &middot; &radic;y<sup>${exp_y}</sup>`,
                        `Simplify the number: &radic;${radicandNum} = &radic;(${pair[0]} &middot; ${rad_val}) = ${coeff_out}&radic;${rad_val}`,
                        `Simplify the x term: &radic;x<sup>${exp_x}</sup> = x<sup>${exp_x}/2</sup> = x<sup>${px_out}</sup>`,
                        `Simplify the y term: &radic;y<sup>${exp_y}</sup> = &radic;(y<sup>${exp_y-1}</sup> &middot; y) = y<sup>${py_out}</sup>&radic;y`,
                        `Combine all the parts outside and inside the radical: ${coeff_out}x<sup>${px_out}</sup>y<sup>${py_out}</sup>&radic;(${rad_val}y)`
                    ]
                });
            }
            allQuestions = shuffle(allQuestions);
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            generateQuestions();
            renderCurrentQuestion();
        }

        function renderCurrentQuestion() {
            if (currentQuestionIndex >= allQuestions.length) {
                quizContainer.innerHTML = `<div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800">Practice Complete!</h2>
                    <p class="mt-2 text-gray-600">You've finished all the questions for this session.</p>
                    <button id="startOverBtn" class="mt-6 bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700">Start Over with New Questions</button>
                </div>`;
                document.getElementById('startOverBtn').addEventListener('click', startQuiz);
                return;
            }

            const q = allQuestions[currentQuestionIndex];
            quizContainer.innerHTML = `
                <div class="mb-4">
                    <h2 class="text-xl font-semibold text-gray-700">Question ${currentQuestionIndex + 1} of ${allQuestions.length}</h2>
                    <p class="mt-1 text-gray-600">Express the expression in the simplest radical form.</p>
                </div>
                <div class="text-center text-3xl my-8">${q.text}</div>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-2">
                    <div class="relative w-full sm:w-auto">
                        <input type="text" id="userAnswer" class="p-3 border border-gray-300 rounded-lg text-center text-lg w-full sm:w-64 pr-12" autofocus>
                        <button type="button" onclick="insertSymbolAtCursor('userAnswer', 'sqrt()', 5)" class="absolute inset-y-0 right-0 flex items-center justify-center w-12 h-full text-gray-600 hover:bg-gray-200 rounded-r-lg text-2xl font-semibold focus:outline-none" title="Insert Square Root">&radic;</button>
                    </div>
                    <button id="checkBtn" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 w-full sm:w-auto">Check</button>
                </div>
                <div id="feedbackContainer" class="mt-6"></div>
            `;

            document.getElementById('checkBtn').addEventListener('click', checkAnswer);
            document.getElementById('userAnswer').addEventListener('keypress', e => { if (e.key === 'Enter') checkAnswer(); });
        }

        const normalizeAnswer = (str) => {
            let s = (str || '').replace(/\s+/g, '').replace(/\*/g, '').toLowerCase();
             // Standardize x to x^1 for comparison
            s = s.replace(/([a-z])(?![^()]*\)|[0-9\^])/g, '$1^1');
            
            const sqrtMatch = s.match(/sqrt\(([^)]+)\)/);
            const sqrtPart = sqrtMatch ? `sqrt(${sqrtMatch[1]})` : '';
            
            let nonSqrtPart = sqrtPart ? s.replace(sqrtPart, '') : s;
            if (nonSqrtPart.match(/^[a-z]/)) nonSqrtPart = '1' + nonSqrtPart;
            if (nonSqrtPart === '' && sqrtPart) nonSqrtPart = '1';

            const coeff = (nonSqrtPart.match(/^-?\d+/) || ['1'])[0];
            const vars = (nonSqrtPart.match(/[a-z]\^\d+/g) || []).sort().join('');
            
            return `${coeff}${vars}${sqrtPart}`;
        };
        
        function checkAnswer() {
            const userAnswerRaw = document.getElementById('userAnswer').value.trim();
            const feedbackContainer = document.getElementById('feedbackContainer');
            const q = allQuestions[currentQuestionIndex];
            const isCorrect = normalizeAnswer(userAnswerRaw) === normalizeAnswer(q.answer);

            let feedbackHTML = `<div class="p-4 rounded-lg solution-box">`;
            if (isCorrect) {
                feedbackHTML += `<h3 class="text-lg font-bold text-green-700">Correct!</h3>`;
            } else {
                feedbackHTML += `<h3 class="text-lg font-bold text-red-700">Not quite.</h3>
                                 <p class="mt-1">Your answer was <strong>${userAnswerRaw || "empty"}</strong>. The correct answer is <strong>${q.answer.replace(/\^1/g, '')}</strong>.</p>`;
            }
            
            feedbackHTML += `<div class="mt-4"><h4 class="font-semibold">Here's how to solve it:</h4><div class="mt-2 space-y-2 text-sm text-gray-700">${q.solutionSteps.join('<br>')}</div></div>`;
            feedbackHTML += `</div><div class="text-center mt-6">
                                <button id="nextBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700">Next Question</button>
                             </div>`;
            
            feedbackContainer.innerHTML = feedbackHTML;
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('userAnswer').disabled = true;
            document.getElementById('nextBtn').addEventListener('click', nextQuestion);
            document.getElementById('nextBtn').focus();
        }

        function nextQuestion() {
            currentQuestionIndex++;
            renderCurrentQuestion();
        }
        
        document.addEventListener('DOMContentLoaded', startQuiz);
    </script>
</body>
</html>

