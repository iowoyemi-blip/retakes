<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations with Radicals Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 0.2em;
        }
        .numerator {
            border-bottom: 1px solid black;
            padding: 0 0.2em;
        }
        .denominator {
            padding: 0 0.2em;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-lg w-full max-w-4xl">
        <div class="p-8 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800">Operations with Radicals Practice</h1>
            <p class="text-gray-600 mt-2">Use the &radic; button or type 'sqrt()' for the square root symbol, e.g., 3sqrt(2).</p>
        </div>

        <div id="quizContainer" class="p-8">
            <!-- The quiz form will be dynamically generated and inserted here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Quiz Results</h2>
            <div id="score" class="text-xl mb-6 font-semibold"></div>
            <div id="detailedResults" class="space-y-4"></div>
             <div class="mt-8 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="retakeQuizBtn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700">Try This Quiz Again</button>
                <button id="generateNewBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700">Generate New Quiz</button>
            </div>
        </div>
    </main>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        const resultsSection = document.getElementById('resultsSection');
        const scoreElement = document.getElementById('score');
        const detailedResultsElement = document.getElementById('detailedResults');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const generateNewBtn = document.getElementById('generateNewBtn');

        let currentQuestions = [];

        // --- UTILITY FUNCTIONS ---
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
        const gcd = (a, b) => { a = Math.abs(a); b = Math.abs(b); return b === 0 ? a : gcd(b, a % b); };

        function insertSymbolAtCursor(inputId, textToInsert, cursorOffset) {
            const input = document.getElementById(inputId);
            if (!input) return;
            const startPos = input.selectionStart;
            const endPos = input.selectionEnd;
            input.value = input.value.substring(0, startPos) + textToInsert + input.value.substring(endPos);
            const newCursorPos = startPos + cursorOffset;
            input.focus();
            input.setSelectionRange(newCursorPos, newCursorPos);
        }

        function simplifyRadical(n) {
            if (n === 0) return { coeff: 0, rad: 1 };
            if (n === 1) return { coeff: 1, rad: 1 };
            let coeff = 1;
            let rad = n;
            for (let i = Math.floor(Math.sqrt(n)); i > 1; i--) {
                if (rad % (i * i) === 0) {
                    coeff *= i;
                    rad /= (i * i);
                }
            }
            return { coeff, rad };
        }

        function formatRadical({ coeff, rad, den = 1 }) {
            if (coeff === 0) return '0';
            
            if (den !== 1) {
                const common = gcd(coeff, den);
                coeff /= common;
                den /= common;
            }

            const radPart = rad === 1 ? '' : `sqrt(${rad})`;
            const coeffPart = Math.abs(coeff) === 1 && rad > 1 ? (coeff < 0 ? '-' : '') : coeff.toString();
            
            if (den === 1) {
                if (coeffPart === '1' && radPart) return radPart;
                return `${coeffPart}${radPart}`;
            } else {
                 if (radPart === '' && coeff === 1) return `1/${den}`;
                 if (coeff === 1 && rad > 1) return `${radPart}/${den}`;
                 return `${coeffPart}${radPart}/${den}`;
            }
        }

        // --- QUESTION GENERATORS ---
        function generateRadicalOperationsQuestions() {
            const questions = [];
            const perfectSquares = [4, 9, 16, 25];
            const radicands = [2, 3, 5, 6, 7];

            // 1a & 1b: Add/Subtract
            let commonRad = shuffle(radicands)[0];
            let sq = shuffle(perfectSquares).slice(0, 2);
            let c1 = getRandomInt(2, 9); let c2 = getRandomInt(2, 9);
            let r1 = sq[0] * commonRad; let r2 = sq[1] * commonRad;
            let ans_c = c1 * Math.sqrt(sq[0]) - c2 * Math.sqrt(sq[1]);
            questions.push({ id: 'q1a', text: `${c1}&radic;${r1} - ${c2}&radic;${r2}`, answer: formatRadical({coeff: ans_c, rad: commonRad})});

            commonRad = shuffle(radicands)[0];
            sq = shuffle(perfectSquares).slice(0, 2);
            c1 = getRandomInt(-5, -2); c2 = getRandomInt(2, 5);
            r1 = sq[0] * commonRad; r2 = sq[1] * commonRad;
            ans_c = c1 * Math.sqrt(sq[0]) + c2 * Math.sqrt(sq[1]);
            questions.push({ id: 'q1b', text: `${c1}&radic;${r1} + ${c2}&radic;${r2}`, answer: formatRadical({coeff: ans_c, rad: commonRad})});

            // 2a & 2b: Multiply
            let r_a = shuffle(radicands)[0] * 2; let r_b = shuffle(perfectSquares)[0] * r_a / 2;
            questions.push({ id: 'q2a', text: `&radic;${r_a} &middot; &radic;${r_b}`, answer: formatRadical(simplifyRadical(r_a * r_b)) });

            let c_b1 = getRandomInt(2,7); let c_b2 = getRandomInt(2,7);
            let r_b1 = shuffle([8,12,18,20])[0]; let r_b2 = shuffle([8,12,18,20])[0];
            const simplified = simplifyRadical(r_b1 * r_b2);
            questions.push({ id: 'q2b', text: `${c_b1}&radic;${r_b1} &middot; ${c_b2}&radic;${r_b2}`, answer: formatRadical({coeff: c_b1 * c_b2 * simplified.coeff, rad: simplified.rad}) });
            
            // 2c & 2d: Divide (simple cases)
            let den_c = shuffle(radicands)[0]; let num_c = den_c * shuffle(perfectSquares)[0];
            questions.push({ id: 'q2c', text: `&radic;${num_c} / &radic;${den_c}`, answer: `${Math.sqrt(num_c/den_c)}` });
            
            let den_d = shuffle(perfectSquares)[0];
            let { coeff: num_d_coeff, rad: num_d_rad } = simplifyRadical(getRandomInt(20, 80));
            questions.push({ id: 'q2d', text: `&radic;${num_d_coeff**2 * num_d_rad} / &radic;${den_d}`, answer: formatRadical({coeff: num_d_coeff, rad: num_d_rad, den: Math.sqrt(den_d)}) });

            // 2e & 2f: Divide (rationalize)
            let r_e_num = shuffle(radicands)[0]; let r_e_den = shuffle(radicands.filter(r => r !== r_e_num))[0];
            questions.push({ id: 'q2e', text: `&radic;${r_e_num} / &radic;${r_e_den}`, answer: formatRadical({coeff: 1, rad: r_e_num * r_e_den, den: r_e_den}) });

            let r_f_num = shuffle(radicands)[0];
            let r_f_mult = shuffle([2,3,5,6,7].filter(r => r !== r_f_num))[0];
            const simplified_f = simplifyRadical(r_f_mult);
            questions.push({ id: 'q2f', text: `&radic;${r_f_num} / &radic;${r_f_num*r_f_mult}`, answer: formatRadical({coeff: simplified_f.coeff, rad: simplified_f.rad, den: r_f_mult})});

            return questions;
        }

        function renderQuizForm() {
            const prefixes_1 = ['a)', 'b)'];
            const prefixes_2 = ['a)', 'b)', 'c)', 'd)', 'e)', 'f)'];
            const q1 = currentQuestions.slice(0, 2);
            const q2 = currentQuestions.slice(2);

            const createQuestionHTML = (q, i, prefixes) => {
                let text = q.text;
                if(text.includes(' / ')){
                    const parts = text.split(' / ');
                    text = `<div class="fraction"><span class="numerator">${parts[0]}</span><span class="denominator">${parts[1]}</span></div>`;
                }
                return `
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center">
                    <p class="flex items-center gap-4 text-xl"><span class="font-semibold">${prefixes[i]}</span>${text}</p>
                    <div class="relative w-full">
                         <input type="text" id="${q.id}" class="w-full p-2 border border-gray-300 rounded-lg pr-10">
                         <button type="button" onclick="insertSymbolAtCursor('${q.id}', 'sqrt()', 5)" class="absolute inset-y-0 right-0 flex items-center justify-center w-10 h-full text-gray-600 hover:bg-gray-200 rounded-r-lg text-2xl font-semibold focus:outline-none" title="Insert Square Root">&radic;</button>
                    </div>
                </div>`;
            }
            const q1HTML = q1.map((q, i) => createQuestionHTML(q, i, prefixes_1)).join('<hr class="my-4 border-dashed">');
            const q2HTML = q2.map((q, i) => createQuestionHTML(q, i, prefixes_2)).join('<hr class="my-4 border-dashed">');
            
            quizContainer.innerHTML = `
                <form id="quizForm">
                    <div class="mb-10"><h2 class="text-xl font-semibold text-gray-700 mb-6">1. Perform the indicated operations, if possible, and simplify.</h2><div class="space-y-4">${q1HTML}</div></div>
                    <div><h2 class="text-xl font-semibold text-gray-700 mb-6">2. Perform the indicated operations and simplify your answer.</h2><div class="space-y-4">${q2HTML}</div></div>
                    <div class="mt-10 text-center"><button type="submit" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg">Grade My Quiz</button></div>
                </form>
            `;
            document.getElementById('quizForm').addEventListener('submit', gradeQuiz);
        }
        
        const normalizeAnswer = str => (str || '').replace(/\s+/g, '').replace('*','').toLowerCase();
        
        function gradeQuiz(event) {
            event.preventDefault();
            let score = 0; let resultsHTML = '';
            
            currentQuestions.forEach(q => {
                const userInput = document.getElementById(q.id).value;
                const isCorrect = normalizeAnswer(userInput) === normalizeAnswer(q.answer);
                if (isCorrect) score++;
                let text = q.text;
                 if(text.includes(' / ')){
                    const parts = text.split(' / ');
                    text = `<div class="fraction"><span class="numerator">${parts[0]}</span><span class="denominator">${parts[1]}</span></div>`;
                }
                resultsHTML += `<div class="p-4 border-l-4 ${isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}">
                    <div class="font-semibold text-gray-800 flex items-center gap-4 text-xl">${text}</div>
                    <p class="mt-2 text-sm">Your answer: <span class="font-medium">${userInput || '<i>No answer</i>'}</span></p>
                    ${!isCorrect ? `<p class="mt-1 text-sm">Correct answer: <span class="font-medium text-green-700">${q.answer}</span></p>` : ''}
                </div>`;
            });
            
            const totalQuestions = currentQuestions.length;
            const percentage = Math.round((score / totalQuestions) * 100);
            let scoreColor = percentage >= 80 ? 'text-green-600' : (percentage >= 60 ? 'text-yellow-600' : 'text-red-500');
            scoreElement.innerHTML = `Your Score: <span class="${scoreColor}">${score} out of ${totalQuestions} (${percentage}%)</span>`;
            detailedResultsElement.innerHTML = resultsHTML;
            quizContainer.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        retakeQuizBtn.addEventListener('click', () => {
            renderQuizForm();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });

        function generateAndRenderQuiz(){
             currentQuestions = generateRadicalOperationsQuestions();
             renderQuizForm();
        }

        generateNewBtn.addEventListener('click', () => {
            generateAndRenderQuiz();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });

        document.addEventListener('DOMContentLoaded', generateAndRenderQuiz);
    </script>
</body>
</html>

