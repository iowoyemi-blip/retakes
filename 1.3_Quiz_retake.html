<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations with Radicals Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .quiz-container {
            transition: all 0.3s ease-in-out;
        }
        .result-item.correct {
            background-color: #f0fdf4;
            border-left-color: #22c55e;
        }
        .result-item.incorrect {
            background-color: #fef2f2;
            border-left-color: #ef4444;
        }
        .question-prefix {
            font-weight: 500;
            flex-shrink: 0;
        }
        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 0.2em;
        }
        .numerator {
            border-bottom: 1px solid black;
            padding: 0 0.2em;
        }
        .denominator {
            padding: 0 0.2em;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-lg w-full max-w-4xl quiz-container">
        <div class="p-8 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800">1.3 Quiz Operations with Radicals Retake</h1>
            <p class="text-gray-600 mt-2">Use the &radic; button or type 'sqrt()' for the square root symbol, e.g., 3sqrt(2).</p>
        </div>

        <div id="quizContainer" class="p-8">
            <!-- The quiz form will be dynamically generated and inserted here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Quiz Results</h2>
            <div id="score" class="text-xl mb-6 font-semibold"></div>
            <div id="detailedResults" class="space-y-4"></div>
             <div class="mt-8 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="retakeQuizBtn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-transform transform hover:scale-105 w-full sm:w-auto">
                    Try This Quiz Again
                </button>
                <button id="generateNewBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-105 w-full sm:w-auto">
                    Generate New Quiz
                </button>
            </div>
        </div>
    </main>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        const resultsSection = document.getElementById('resultsSection');
        const scoreElement = document.getElementById('score');
        const detailedResultsElement = document.getElementById('detailedResults');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const generateNewBtn = document.getElementById('generateNewBtn');

        let currentQuestions = [];

        // --- UTILITY FUNCTIONS ---
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);

        function insertSymbolAtCursor(inputId, textToInsert, cursorOffset) {
            const input = document.getElementById(inputId);
            if (!input) return;
            const startPos = input.selectionStart;
            const endPos = input.selectionEnd;
            input.value = input.value.substring(0, startPos) + textToInsert + input.value.substring(endPos);
            const newCursorPos = startPos + cursorOffset;
            input.focus();
            input.setSelectionRange(newCursorPos, newCursorPos);
        }

        // --- QUESTION GENERATORS ---
        function generateRadicalOperationsQuestions() {
            const questions = [];
            const perfectSquares = [4, 9, 16, 25];
            const radicands = [2, 3, 5, 6, 7];

            // Section 1: Add/Subtract
            let commonRad = shuffle(radicands)[0];
            let sq = shuffle(perfectSquares).slice(0, 2);
            let c1 = getRandomInt(2, 9); let c2 = getRandomInt(2, 9);
            let r1 = sq[0] * commonRad; let r2 = sq[1] * commonRad;
            let ans1 = c1 * Math.sqrt(sq[0]) - c2 * Math.sqrt(sq[1]);
            questions.push({ id: 'q1a', text: `${c1}&radic;${r1} - ${c2}&radic;${r2}`, answer: `${ans1}sqrt(${commonRad})`});

            commonRad = shuffle(radicands)[0];
            sq = shuffle(perfectSquares).slice(0, 2);
            c1 = getRandomInt(-5, -2); c2 = getRandomInt(2, 5);
            r1 = sq[0] * commonRad; r2 = sq[1] * commonRad;
            let ans2 = c1 * Math.sqrt(sq[0]) + c2 * Math.sqrt(sq[1]);
            questions.push({ id: 'q1b', text: `${c1}&radic;${r1} + ${c2}&radic;${r2}`, answer: `${ans2}sqrt(${commonRad})`});

            // Section 2: Multiply/Divide
            // a) sqrt(a) * sqrt(b)
            let r_a = shuffle(radicands)[0] * 2; let r_b = shuffle(perfectSquares)[0] * r_a / 2;
            let ans_a_out = Math.sqrt(shuffle(perfectSquares)[0]); let ans_a_in = r_a * r_b / ans_a_out / ans_a_out;
            questions.push({ id: 'q2a', text: `&radic;${r_a} &middot; &radic;${r_b}`, answer: `${Math.sqrt(r_a*r_b)}`});
            if (!Number.isInteger(Math.sqrt(r_a*r_b))) {
                 let rad = r_a * r_b;
                 let sq_part = 1;
                 for(let i=perfectSquares.length-1; i>=0; i--){ if(rad % perfectSquares[i] === 0) {sq_part = perfectSquares[i]; break;} }
                 questions[questions.length-1].answer = `${Math.sqrt(sq_part)}sqrt(${rad/sq_part})`;
            }


            // b) c1*sqrt(a) * c2*sqrt(b)
            let c_b1 = getRandomInt(2,7); let c_b2 = getRandomInt(2,7);
            let r_b1 = shuffle([8,12,18,20])[0]; let r_b2 = shuffle([8,12,18,20])[0];
            let rad_b = r_b1 * r_b2;
            let sq_b = 1;
            for(let i=perfectSquares.length-1; i>=0; i--){ if(rad_b % perfectSquares[i] === 0) {sq_b = perfectSquares[i]; break;} }
            let ans_b = `${c_b1*c_b2*Math.sqrt(sq_b)}sqrt(${rad_b/sq_b})`;
            if (rad_b/sq_b === 1) ans_b = `${c_b1*c_b2*Math.sqrt(sq_b)}`;
            questions.push({ id: 'q2b', text: `${c_b1}&radic;${r_b1} &middot; ${c_b2}&radic;${r_b2}`, answer: ans_b });

            // c) sqrt(a) / sqrt(b) where a is multiple of b
            let den_c = shuffle(radicands)[0]; let num_c = den_c * shuffle(perfectSquares)[0];
            questions.push({ id: 'q2c', text: `<div class="fraction"><span class="numerator">&radic;${num_c}</span><span class="denominator">&radic;${den_c}</span></div>`, answer: `${Math.sqrt(num_c/den_c)}` });
            
            // d) sqrt(a) / sqrt(b) where b is perfect square
            let den_d = shuffle(perfectSquares)[0];
            let num_d_rad = shuffle(radicands)[0];
            let num_d_sq = shuffle(perfectSquares)[0];
            let ans_d_out = Math.sqrt(num_d_sq); let ans_d_in = num_d_rad;
            let ans_d = `${ans_d_out}sqrt(${ans_d_in}) / ${Math.sqrt(den_d)}`;
            if (ans_d_out % Math.sqrt(den_d) === 0) {
                ans_d = `${ans_d_out/Math.sqrt(den_d)}sqrt(${ans_d_in})`;
            }
            questions.push({ id: 'q2d', text: `<div class="fraction"><span class="numerator">&radic;${num_d_sq*num_d_rad}</span><span class="denominator">&radic;${den_d}</span></div>`, answer: ans_d});

            // e) Rationalize
            let r_e = shuffle(radicands).slice(0,2);
            questions.push({ id: 'q2e', text: `<div class="fraction"><span class="numerator">&radic;${r_e[0]}</span><span class="denominator">&radic;${r_e[1]}</span></div>`, answer: `sqrt(${r_e[0]*r_e[1]})/${r_e[1]}`});

            // f) Simplify then rationalize
            let r_f_num = shuffle(radicands)[0];
            let r_f_mult = shuffle([2,3,4,5])[0];
            questions.push({ id: 'q2f', text: `<div class="fraction"><span class="numerator">&radic;${r_f_num}</span><span class="denominator">&radic;${r_f_num*r_f_mult}</span></div>`, answer: `sqrt(${r_f_mult})/${r_f_mult}`});

            return questions;
        }

        // --- CORE QUIZ LOGIC ---
        function generateAndRenderQuiz() {
            currentQuestions = generateRadicalOperationsQuestions();
            renderQuizForm(currentQuestions);
            quizContainer.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            window.scrollTo(0, 0);
        }

        function renderQuizForm(questions) {
            const prefixes_1 = ['a)', 'b)'];
            const prefixes_2 = ['a)', 'b)', 'c)', 'd)', 'e)', 'f)'];
            const q1 = questions.slice(0, 2);
            const q2 = questions.slice(2);

            const createQuestionHTML = (q, i, prefixes) => `
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center">
                    <p class="flex items-center gap-4 text-xl"><span class="question-prefix">${prefixes[i]}</span>${q.text}</p>
                    <div class="relative w-full">
                         <input type="text" id="${q.id}" class="w-full p-2 border border-gray-300 rounded-lg pr-10">
                         <button type="button" onclick="insertSymbolAtCursor('${q.id}', 'sqrt()', 5)" class="absolute inset-y-0 right-0 flex items-center justify-center w-10 h-full text-gray-600 hover:bg-gray-200 rounded-r-lg text-2xl font-semibold focus:outline-none" title="Insert Square Root">&radic;</button>
                    </div>
                </div>`;

            const q1HTML = q1.map((q, i) => createQuestionHTML(q, i, prefixes_1)).join('<hr class="my-4 border-dashed">');
            const q2HTML = q2.map((q, i) => createQuestionHTML(q, i, prefixes_2)).join('<hr class="my-4 border-dashed">');
            
            quizContainer.innerHTML = `
                <form id="quizForm">
                    <div class="mb-10">
                        <h2 class="text-xl font-semibold text-gray-700 mb-6">1. Perform the indicated operations, if possible, and simplify.</h2>
                        <div class="space-y-4">${q1HTML}</div>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-700 mb-6">2. Perform the indicated operations and simplify your answer.</h2>
                        <div class="space-y-4">${q2HTML}</div>
                    </div>
                    <div class="mt-10 text-center">
                        <button type="submit" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg">Grade My Quiz</button>
                    </div>
                </form>
            `;
            document.getElementById('quizForm').addEventListener('submit', gradeQuiz);
        }
        
        const normalizeAnswer = (str) => {
            let s = str.replace(/\s+/g, '').replace(/\*/g, '').toLowerCase();
            if (!s.includes('sqrt') && !s.includes('/')) return s;

            let denominator = '';
            if (s.includes('/')) {
                const parts = s.split('/');
                s = parts[0];
                denominator = `/${parts[1]}`;
            }

            const sqrtMatch = s.match(/sqrt\([^)]+\)/);
            if (!sqrtMatch) return s + denominator;
            
            const sqrtPart = sqrtMatch[0];
            let coeffPart = s.replace(sqrtPart, '');

            if (coeffPart === '') coeffPart = '1';
            if (coeffPart === '-') coeffPart = '-1';
            
            if (coeffPart === '1' && sqrtPart) return sqrtPart + denominator;

            return coeffPart + sqrtPart + denominator;
        };
        
        function gradeQuiz(event) {
            event.preventDefault();
            let score = 0;
            let resultsHTML = '';
            
            currentQuestions.forEach(q => {
                const userInput = document.getElementById(q.id).value;
                const isCorrect = normalizeAnswer(userInput) === normalizeAnswer(q.answer);

                if (isCorrect) score++;

                resultsHTML += `<div class="result-item border-l-4 p-4 rounded-md ${isCorrect ? 'correct' : 'incorrect'}">
                    <div class="font-semibold text-gray-800 flex items-center gap-4 text-xl">${q.text}</div>
                    <p class="mt-2 text-sm">Your answer: <span class="font-medium ${isCorrect ? 'text-green-700' : 'text-red-700'}">${userInput || '<i>No answer</i>'}</span></p>
                    ${!isCorrect ? `<p class="mt-1 text-sm">Correct answer: <span class="font-medium text-green-700">${q.answer}</span></p>` : ''}
                </div>`;
            });
            
            const totalQuestions = currentQuestions.length;
            const percentage = Math.round((score / totalQuestions) * 100);
            let scoreColor = percentage >= 80 ? 'text-green-600' : (percentage >= 60 ? 'text-yellow-600' : 'text-red-600');
            scoreElement.innerHTML = `Your Score: <span class="${scoreColor}">${score} out of ${totalQuestions} (${percentage}%)</span>`;
            detailedResultsElement.innerHTML = resultsHTML;
            quizContainer.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        // --- EVENT LISTENERS ---
        retakeQuizBtn.addEventListener('click', () => {
            renderQuizForm(currentQuestions);
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });
        generateNewBtn.addEventListener('click', generateAndRenderQuiz);
        document.addEventListener('DOMContentLoaded', generateAndRenderQuiz);
    </script>
</body>
</html>


