<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>2.1 Quiz Retake (Offline Safe)</title>
<style>
  :root { --bg:#f5f7fb; --text:#1f2937; --muted:#6b7280; --primary:#3b82f6; --primary-d:#2563eb; --ok:#16a34a; --err:#dc2626; --card:#ffffff; --ring:#93c5fd; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Apple Color Emoji','Segoe UI Emoji'; background: var(--bg); color: var(--text); }
  .container { max-width: 900px; margin: 0 auto; padding: 24px; }
  h1 { margin: 0 0 8px 0; font-size: 28px; }
  .muted { color: var(--muted); }
  .card { background: var(--card); border-radius: 14px; padding: 20px; box-shadow: 0 6px 16px rgba(0,0,0,.08); }
  .btn { display:inline-block; padding: 12px 18px; border-radius: 10px; border: 0; color: #fff; background: var(--primary); cursor: pointer; font-weight: 700; }
  .btn:hover { background: var(--primary-d); }
  .btn:disabled { background:#9ca3af; cursor:not-allowed; }
  .field { width: 100%; padding: 10px 12px; border: 1px solid #cbd5e1; border-radius: 10px; outline: none; font-size: 16px; }
  .field:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--ring); }
  .row { display:flex; gap:10px; align-items:center; }
  .row-col { display:flex; flex-direction: column; gap:10px; }
  .mt { margin-top: 16px; }
  .badge { background:#ede9fe; color:#5b21b6; padding:4px 8px; border-radius: 9999px; font-size:12px; font-weight:700; }
  .right { text-align:right; }
  .answer-ok { border:2px solid #16a34a; background:#ecfdf5; }
  .answer-err { border:2px solid #dc2626; background:#fef2f2; }
  .hidden { display:none; }
  .qline { font-size: 18px; font-weight: 600; }
  .katexish { font-family: Cambria, 'Times New Roman', serif; letter-spacing:.2px; }
</style>
</head>
<body>
  <div class="container">
    <div id="start" class="card" role="region" aria-label="Start">
      <h1>2.1 Quiz Retake</h1>
      <p class="muted">Four-Function Calculator Allowed. Enter your name to begin.</p>
      <div class="row-col mt">
        <label for="name" class="muted">Student Name</label>
        <input id="name" class="field" placeholder="e.g., Jane Doe" />
        <button id="go" class="btn mt">Start Quiz</button>
      </div>
    </div>

    <div id="quiz" class="hidden">
      <div class="right muted">Student: <strong id="who"></strong></div>
      <div class="right muted" id="score">Score: 0 / 0 (Total: 6)</div>
      <div class="right"><button id="reset" class="btn">Reset This Set</button></div>
      <div id="qs" class="row-col mt"></div>
      <div id="done" class="hidden mt"></div>
    </div>
  </div>

<script>
(function(){
  "use strict";

  // state
  let studentName = ""; let score = 0; let answered = 0;

  // dom
  const start = document.getElementById('start');
  const quiz = document.getElementById('quiz');
  const who = document.getElementById('who');
  const nameInput = document.getElementById('name');
  const go = document.getElementById('go');
  const qs = document.getElementById('qs');
  const resetBtn = document.getElementById('reset');
  const done = document.getElementById('done');
  const scoreBox = document.getElementById('score');

  function updateScore(total){ scoreBox.textContent = `Score: ${score} / ${answered} (Total: ${total})`; }

  function parseNumeric(s){
    if(!s) return NaN;
    const raw = (""+s).trim().replace(/\s+/g,'');
    if(/^[-+]?\d+\/[-+]?\d+$/.test(raw)){
      const [a,b] = raw.split('/').map(Number);
      if(b===0) return NaN; return a/b;
    }
    return Number(raw);
  }
  function eq(a,b){ return Math.abs(a-b) <= 1e-9; }

  const QUESTIONS = [
    { tex:"Evaluate: 12 − 4 + 6", val:14, sol:"Compute left to right: 12−4=8; 8+6=14."},
    { tex:"Evaluate: 24 ÷ 4 · 2", val:12, sol:"Division then multiplication (left to right): 24÷4=6; 6·2=12."},
    { tex:"Evaluate: 40 − 30 ÷ 6 · 3 − 20", val:5, sol:"30÷6=5; 5·3=15; then 40−15−20=5."},
    { tex:"Evaluate: 20 − 18 ÷ 2 + 4 − 3(1−3) · 3^2", val:69, sol:"18÷2=9; (1−3)=−2; 3^2=9; 3·(−2)·9=−54; 20−9+4−(−54)=69."},
    { tex:"Evaluate: (4^2 − 8) / ( 3(7+4) − 5 )", val:(16-8)/(3*(7+4)-5), sol:"4^2=16 → numerator 8. Denominator: 3(11)=33; 33−5=28; 8/28=2/7."},
    { tex:"Evaluate: |3 − 2^2| − |2^2 − 3|", val:0, sol:"2^2=4 → |3−4|=1, |4−3|=1; 1−1=0."}
  ];

  function render(){
    score = 0; answered = 0; updateScore(QUESTIONS.length);
    done.classList.add('hidden'); done.innerHTML = "";
    qs.innerHTML = "";
    QUESTIONS.forEach((q, i) => {
      const card = document.createElement('div'); card.className = "card mt";
      const qNum = i+1;
      card.innerHTML = `
        <div class="row" style="justify-content:space-between; align-items:flex-start;">
          <div class="qline katexish"><strong>${qNum}.</strong> ${q.tex}</div>
          <span class="badge">Evaluate</span>
        </div>
        <div class="row mt">
          <input id="ans-${i}" class="field" placeholder="Enter number or fraction, e.g., 2/7"/>
          <button id="btn-${i}" class="btn">Submit</button>
        </div>
        <div id="sol-${i}" class="hidden mt muted"></div>
      `;
      qs.appendChild(card);

      const btn = card.querySelector(`#btn-${i}`);
      const field = card.querySelector(`#ans-${i}`);
      const sol = card.querySelector(`#sol-${i}`);
      btn.addEventListener('click', function(){
        if (field.disabled) return;
        const val = parseNumeric(field.value);
        const ok = Number.isFinite(val) && eq(val, q.val);
        answered++;
        if (ok){ score++; field.classList.add('answer-ok'); }
        else { field.classList.add('answer-err'); sol.classList.remove('hidden'); sol.textContent = "Correct answer: " + (Math.abs(q.val - 2/7) < 1e-9 ? "2/7" : q.val); }
        field.disabled = true; btn.disabled = true;
        updateScore(QUESTIONS.length);
        // show worked solution
        sol.classList.remove('hidden');
        sol.innerHTML = `<div><strong>Solution:</strong> ${q.sol}</div>`;
        // completion
        if (answered === QUESTIONS.length && score === QUESTIONS.length){
          showDone();
        }
      });
    });
  }

  function showDone(){
    done.innerHTML = `
      <div class="card">
        <h2 style="margin:0 0 6px 0;">Mastery Achieved!</h2>
        <p class="muted">Great work! Download verification below.</p>
        <button id="dl" class="btn mt">Download Verification File</button>
      </div>`;
    done.classList.remove('hidden');
    document.getElementById('dl').addEventListener('click', function(){
      const data = {
        studentName, quizTitle:"2.1 Quiz Retake",
        completionDate:new Date().toISOString(),
        masteryAttempt:{ score, totalQuestions:QUESTIONS.length, percentage:100,
          questions: QUESTIONS.map((q,i)=>({number:i+1, question:q.tex, correctValue:q.val})) }
      };
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `${studentName.replace(/[^a-z0-9]/gi,'_').toLowerCase()}_quiz_2-1_retake.json`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });
  }

  go.addEventListener('click', function(){
    const n = nameInput.value.trim();
    if(!n){ alert("Please enter your name to start."); return; }
    studentName = n; who.textContent = studentName;
    start.classList.add('hidden'); quiz.classList.remove('hidden'); render();
  });

  resetBtn.addEventListener('click', render);
})();</script>
</body>
</html>
