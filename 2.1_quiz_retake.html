<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order of Operations Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .quiz-container {
            transition: all 0.3s ease-in-out;
        }
        .result-item.correct {
            background-color: #f0fdf4;
            border-left-color: #22c55e;
        }
        .result-item.incorrect {
            background-color: #fef2f2;
            border-left-color: #ef4444;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.1em;
            background-color: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .question-label {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .question-prefix {
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-lg w-full max-w-3xl quiz-container">
        <div class="p-8 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800">Order of Operations Practice</h1>
            <p class="text-gray-600 mt-2">Generate a new quiz anytime. Four-Function Calculator Allowed.</p>
        </div>

        <div id="quizContainer" class="p-8">
            <!-- The quiz form will be dynamically generated and inserted here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Quiz Results</h2>
            <div id="score" class="text-xl mb-6 font-semibold"></div>
            <div id="detailedResults" class="space-y-4"></div>
             <div class="mt-8 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="retakeQuizBtn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-transform transform hover:scale-105 w-full sm:w-auto">
                    Try This Quiz Again
                </button>
                <button id="generateNewBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-105 w-full sm:w-auto">
                    Generate New Quiz
                </button>
            </div>
        </div>
    </main>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        const resultsSection = document.getElementById('resultsSection');
        const scoreElement = document.getElementById('score');
        const detailedResultsElement = document.getElementById('detailedResults');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const generateNewBtn = document.getElementById('generateNewBtn');

        let currentQuestions = [];

        // --- UTILITY FUNCTIONS ---
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        
        // --- QUESTION GENERATORS ---
        function generateOrderOfOperationsQuestions() {
            const questions = [];
            
            // a. Simple addition/subtraction (left to right)
            const n1a = getRandomInt(10, 20);
            const n2a = getRandomInt(2, 9);
            const n3a = getRandomInt(2, 9);
            questions.push({
                id: 'q_a',
                text: `<code>${n1a} - ${n2a} + ${n3a}</code>`,
                answer: (n1a - n2a + n3a).toString()
            });

            // b. Simple multiplication/division (left to right, ensures whole number)
            const n1b = getRandomInt(2, 8);
            const n2b = getRandomInt(2, 5);
            const n3b = getRandomInt(2, 5);
            questions.push({
                id: 'q_b',
                text: `<code>${n1b * n2b} ÷ ${n2b} · ${n3b}</code>`,
                answer: (n1b * n3b).toString()
            });

            // c. Mix of operations
            const n1c = getRandomInt(30, 50);
            const n2c_mult = getRandomInt(4, 8);
            const n2c_div = getRandomInt(2, 4);
            const n3c = getRandomInt(2, 5);
            const n4c = getRandomInt(10, 25);
            questions.push({
                id: 'q_c',
                text: `<code>${n1c} - ${n2c_mult * n2c_div} ÷ ${n2c_div} · ${n3c} - ${n4c}</code>`,
                answer: (n1c - (n2c_mult * n3c) - n4c).toString()
            });

            // d. Complex with parentheses and exponents
            const n1d = getRandomInt(20, 30);
            const n2d_mult = getRandomInt(2, 5);
            const n2d_div = getRandomInt(2, 4);
            const n3d = getRandomInt(2, 8);
            const n4d_c1 = getRandomInt(2, 5);
            const n4d_c2 = getRandomInt(6, 10); // Ensure (c1-c2) is negative
            const n5d_base = getRandomInt(2, 4);
            questions.push({
                id: 'q_d',
                text: `<code>${n1d} - ${n2d_mult * n2d_div} ÷ ${n2d_div} + ${n3d} - ${n4d_c1}(${n4d_c1} - ${n4d_c2}) · ${n5d_base}²</code>`,
                answer: (n1d - n2d_mult + n3d - n4d_c1 * (n4d_c1 - n4d_c2) * (n5d_base**2)).toString()
            });

            // e. Fraction bar as grouping
            let num_e, den_e, ans_e;
            let n1e, n2e, n3e, n4e, n5e, n6e;
            do {
                n1e = getRandomInt(3, 6); // base for square
                n2e = getRandomInt(1, 10);
                n3e = getRandomInt(2, 5);
                n4e = getRandomInt(2, 5);
                n5e = getRandomInt(2, 5);
                n6e = getRandomInt(1, 10);
                num_e = n1e**2 - n2e;
                den_e = n3e * (n4e + n5e) - n6e;
            } while (den_e === 0 || num_e % den_e !== 0); // Loop until denominator isn't 0 and answer is an integer
            ans_e = num_e / den_e;
            questions.push({
                id: 'q_e',
                text: `<div class="flex flex-col items-center text-lg">
                           <span class="border-b-2 border-gray-800 px-4"><code>${n1e}² - ${n2e}</code></span>
                           <span><code>${n3e}(${n4e}+${n5e}) - ${n6e}</code></span>
                       </div>`,
                answer: ans_e.toString()
            });
            
            // f. Absolute value and exponents
            const n1f = getRandomInt(1, 8);
            const n2f = getRandomInt(2, 4);
            const n3f = getRandomInt(2, 4);
            const n4f = getRandomInt(1, 8);
            questions.push({
                id: 'q_f',
                text: `<code>|${n1f} - ${n2f}²| - |${n3f}² - ${n4f}|</code>`,
                answer: (Math.abs(n1f - n2f**2) - Math.abs(n3f**2 - n4f)).toString()
            });

            return questions;
        }

        // --- CORE QUIZ LOGIC ---
        function generateAndRenderQuiz() {
            currentQuestions = generateOrderOfOperationsQuestions();
            renderQuizForm(currentQuestions);
            quizContainer.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            window.scrollTo(0, 0);
        }

        function renderQuizForm(questions) {
            const questionPrefixes = ['a.', 'b.', 'c.', 'd.', 'e.', 'f.'];
            const questionsHTML = questions.map((q, index) => `
                <div class="flex flex-col md:flex-row md:items-center">
                    <div class="md:w-1/2 text-gray-700 mb-2 md:mb-0">
                       <label for="${q.id}" class="question-label">
                           <span class="question-prefix">${questionPrefixes[index]}</span>
                           ${q.text}
                       </label>
                    </div>
                    <input type="text" id="${q.id}" name="${q.id}" class="md:w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
            `).join('');

            quizContainer.innerHTML = `
                <form id="quizForm">
                    <div class="mb-10">
                        <h2 class="text-xl font-semibold text-gray-700 mb-6">Evaluate the expression:</h2>
                        <div class="space-y-8">${questionsHTML}</div>
                    </div>
                    <div class="mt-10 text-center">
                        <button type="submit" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-transform transform hover:scale-105">
                            Grade My Quiz
                        </button>
                    </div>
                </form>
            `;
            
            document.getElementById('quizForm').addEventListener('submit', gradeQuiz);
        }

        function gradeQuiz(event) {
            event.preventDefault();
            
            let score = 0;
            let resultsHTML = '';
            const questionPrefixes = ['a.', 'b.', 'c.', 'd.', 'e.', 'f.'];

            currentQuestions.forEach((q, index) => {
                const inputElement = document.getElementById(q.id);
                const userAnswerRaw = inputElement.value.trim();
                const userAnswer = userAnswerRaw.replace(/\s+/g, '');
                
                const isCorrect = (userAnswer === q.answer);

                if (isCorrect) {
                    score++;
                }

                resultsHTML += `
                    <div class="result-item border-l-4 p-4 rounded-md ${isCorrect ? 'correct' : 'incorrect'}">
                        <div class="font-semibold text-gray-800 flex items-center gap-4">
                            <span>${questionPrefixes[index]}</span> ${q.text}
                        </div>
                        <p class="mt-2 text-sm">Your answer: <span class="font-medium ${isCorrect ? 'text-green-700' : 'text-red-700'}">${userAnswerRaw || '<i>No answer</i>'}</span></p>
                        ${!isCorrect ? `<p class="mt-1 text-sm">Correct answer: <span class="font-medium text-green-700">${q.answer}</span></p>` : ''}
                    </div>
                `;
            });

            const totalQuestions = currentQuestions.length;
            const percentage = Math.round((score / totalQuestions) * 100);

            let scoreColor;
            if (percentage >= 80) scoreColor = 'text-green-600';
            else if (percentage >= 60) scoreColor = 'text-yellow-600';
            else scoreColor = 'text-red-600';

            scoreElement.innerHTML = `Your Score: <span class="${scoreColor}">${score} out of ${totalQuestions} (${percentage}%)</span>`;
            detailedResultsElement.innerHTML = resultsHTML;

            quizContainer.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        // --- EVENT LISTENERS ---
        retakeQuizBtn.addEventListener('click', function() {
            renderQuizForm(currentQuestions);
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });

        generateNewBtn.addEventListener('click', generateAndRenderQuiz);

        // --- INITIALIZE ---
        document.addEventListener('DOMContentLoaded', generateAndRenderQuiz);
    </script>
</body>
</html>

