<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solving Equations - Practice Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .equation-text {
            font-size: 1.5rem; /* Larger font for equations */
            font-weight: 500;
            color: #1F2937; /* A dark gray for good contrast */
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .feedback-correct {
            color: #059669;
            background-color: #D1FAE5;
            border-left: 4px solid #059669;
        }
        .feedback-incorrect {
            color: #DC2626;
            background-color: #FEE2E2;
            border-left: 4px solid #DC2626;
        }
        .option-btn.selected {
            background-color: #3B82F6;
            color: white;
            border-color: #2563EB;
        }
        .solution-steps {
            text-align: left;
            padding: 1rem;
            margin-top: 1rem;
            background-color: #f3f4f6;
            border-radius: 0.5rem;
            white-space: pre-wrap; /* Allows line breaks */
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div id="quiz-container" class="w-full max-w-2xl bg-white p-6 sm:p-8 rounded-xl shadow-lg">
        <div id="quiz-header">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 text-center">Solving Equations Practice Quiz</h1>
            <p class="text-gray-500 text-center mt-2">Solving Linear Equations</p>
            <div class="bg-gray-200 h-1 rounded-full mt-6">
                <div id="progress-bar" class="bg-blue-500 h-1 rounded-full" style="width: 0%;"></div>
            </div>
            <p id="progress-text" class="text-sm text-gray-500 text-right mt-1">Question 0 / 10</p>
        </div>

        <div id="question-area" class="mt-8">
            <p id="question-instruction" class="text-lg font-semibold text-gray-700"></p>
            <div id="question-text" class="equation-text my-4 text-center bg-gray-50 p-6 rounded-lg"></div>
            
            <div id="solve-input-area" class="hidden">
                <label for="answer-input" class="block text-sm font-medium text-gray-700 mb-1">Enter your answer (as a fraction like -2/3 if needed):</label>
                <input type="text" id="answer-input" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="e.g., 4 or -2/3">
            </div>

            <div id="classify-options-area" class="hidden grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
                 <button data-value="one" class="option-btn btn w-full text-center py-3 px-4 bg-white border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50">One Solution</button>
                 <button data-value="no" class="option-btn btn w-full text-center py-3 px-4 bg-white border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50">No Solution</button>
                 <button data-value="infinite" class="option-btn btn w-full text-center py-3 px-4 bg-white border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50">Infinitely Many Solutions</button>
            </div>

            <div class="mt-6 flex flex-col sm:flex-row gap-3">
                 <button id="check-btn" class="btn w-full sm:w-1/2 bg-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-600">Check Answer</button>
                 <button id="next-btn" class="btn w-full sm:w-1/2 bg-gray-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 hidden">Next Question</button>
            </div>
        </div>

        <div id="feedback-area" class="mt-4 p-4 rounded-md text-center hidden"></div>

        <div id="results-area" class="hidden text-center mt-8">
            <h2 class="text-2xl font-bold text-gray-800">Quiz Complete!</h2>
            <p class="text-gray-600 mt-2">You've finished the practice quiz.</p>
            <p id="score-text" class="text-4xl font-bold mt-4"></p>
            <p id="final-message" class="text-lg text-gray-500 mt-2"></p>
            <button id="restart-btn" class="btn mt-8 bg-blue-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-600">Practice Again</button>
        </div>
    </div>

    <script>
        // --- UTILITY FUNCTIONS ---
        const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const gcd = (a, b) => {
            a = Math.abs(a);
            b = Math.abs(b);
            return b === 0 ? a : gcd(b, a % b);
        };
        const simplifyFraction = (n, d) => {
            if (d === 0) return [n, d]; // Avoid division by zero
            const common = gcd(n, d);
            let newN = n / common;
            let newD = d / common;
            if (newD < 0) { // Keep denominator positive
                newN *= -1;
                newD *= -1;
            }
            return [newN, newD];
        }
        const shuffle = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        };

        // --- QUESTION GENERATORS ---
        const questionGenerators = {
            solveDistributive: () => {
                const a = randInt(2, 5), b = randInt(2, 4), x = randInt(-5, 5), c = randInt(1, 5);
                const e = randInt(2, 4);
                let f = randInt(2, 4);
                while (a*b === e*f) f = randInt(2,4);
                const g = randInt(1, 5), d = a * (b * x + c) - e * (f * x + g);
                const question = `${a}(${b}x + ${c}) = ${d} + ${e}(${f}x + ${g})`;
                const answer = x.toString();
                const steps = `Step 1: Distribute on both sides.\n  ${a*b}x + ${a*c} = ${d} + ${e*f}x + ${e*g}\n` +
                              `Step 2: Combine like terms.\n  ${a*b}x + ${a*c} = ${e*f}x + ${d+e*g}\n` +
                              `Step 3: Move variable terms to one side.\n  ${a*b - e*f}x + ${a*c} = ${d+e*g}\n` +
                              `Step 4: Isolate the variable term.\n  ${a*b - e*f}x = ${d+e*g - a*c}\n` +
                              `Step 5: Solve for x.\n  x = ${answer}`;
                return { instruction: "Solve the equation:", question, type: 'solve', answer, steps };
            },
            solveFractions: () => {
                let ansN, ansD, coeffN, coeffD, const1N, const1D, const2N, const2D, step1_resN, step1_resD;
                const maxVal = 10; // Max value for numerators/denominators

                // Loop until all generated fractions in the question are proper and within the desired range
                do {
                    // Generate a simple fractional answer (ensures the problem is solvable with fractions)
                    [ansN, ansD] = simplifyFraction(randInt(1, 9) * (randInt(0, 1) ? 1 : -1), randInt(2, 10));
                    if (ansD === 1) continue; // The answer must be a fraction

                    // Generate the coefficient and constant fractions that the student will see
                    [coeffN, coeffD] = simplifyFraction(randInt(1, 9), randInt(2, 10));
                    [const1N, const1D] = simplifyFraction(randInt(1, 9), randInt(2, 10));
                    
                    // Work backwards to calculate the third fraction based on the others
                    [step1_resN, step1_resD] = simplifyFraction(coeffN * ansN, coeffD * ansD);
                    [const2N, const2D] = simplifyFraction(step1_resN * const1D + const1N * step1_resD, step1_resD * const1D);

                } while (
                    // This is the crucial check: ensure all fractions in the *question* are within bounds
                    coeffD > maxVal || Math.abs(coeffN) > maxVal || Math.abs(coeffN) === coeffD ||
                    const1D > maxVal || Math.abs(const1N) > maxVal || Math.abs(const1N) === const1D ||
                    const2D > maxVal || Math.abs(const2N) > maxVal || Math.abs(const2N) === const2D
                );

                const answer = `${ansN}/${ansD}`;
                // Recalculate the intermediate step for the solution text with the final numbers
                [step1_resN, step1_resD] = simplifyFraction(coeffN * ansN, coeffD * ansD);

                const question = `(${coeffN}/${coeffD})x + ${const1N}/${const1D} = ${const2N}/${const2D}`;
                const steps = `Step 1: Subtract ${const1N}/${const1D} from both sides.\n` +
                              `  (${coeffN}/${coeffD})x = (${const2N}/${const2D}) - (${const1N}/${const1D})\n` +
                              `  (${coeffN}/${coeffD})x = ${step1_resN}/${step1_resD}\n\n` +
                              `Step 2: Multiply both sides by the reciprocal of (${coeffN}/${coeffD}), which is (${coeffD}/${coeffN}).\n` +
                              `  x = (${step1_resN}/${step1_resD}) * (${coeffD}/${coeffN})\n\n` +
                              `Step 3: Multiply the fractions and simplify.\n` +
                              `  x = ${step1_resN * coeffD}/${step1_resD * coeffN}\n` +
                              `  x = ${answer}`;
                return { instruction: "Solve the equation:", question, type: 'solve', answer, steps };
            },
            solveFractionDistributive: () => {
                let distN, distD, const1N, const1D, const2N, const2D;
                let c, d; // parts inside parenthesis
                const maxVal = 10;

                // Loop until all generated fractions in the question are proper and within range
                do {
                    [distN, distD] = simplifyFraction(randInt(1, maxVal - 1), randInt(2, maxVal));
                    c = randInt(2, 9); // coefficient of x
                    d = randInt(1, 9); // constant in parenthesis
                    [const1N, const1D] = simplifyFraction(randInt(1, maxVal - 1), randInt(2, maxVal));
                    [const2N, const2D] = simplifyFraction(randInt(1, maxVal - 1), randInt(2, maxVal));
                } while (
                    distD === 1 || Math.abs(distN) === distD ||
                    const1D === 1 || Math.abs(const1N) === const1D ||
                    const2D === 1 || Math.abs(const2N) === const2D
                );

                // Recalculate steps with the validated numbers
                // Step 1: Distribute
                const [distTermX_N, distTermX_D] = simplifyFraction(distN * c, distD);
                const [distTermC_N, distTermC_D] = simplifyFraction(distN * d, distD);
                
                // Step 2: Combine like terms
                let [combinedConstN, combinedConstD] = simplifyFraction(distTermC_N * const1D + const1N * distTermC_D, distTermC_D * const1D);
                
                // Step 3: Move constant
                let [rhsN, rhsD] = simplifyFraction(const2N * combinedConstD - combinedConstN * const2D, const2D * combinedConstD);

                // Step 4: Multiply by reciprocal
                let [ansN, ansD] = simplifyFraction(rhsN * distTermX_D, rhsD * distTermX_N);

                const question = `(${distN}/${distD})(${c}x + ${d}) + ${const1N}/${const1D} = ${const2N}/${const2D}`;
                const answer = ansD === 1 ? `${ansN}` : `${ansN}/${ansD}`;
                
                const steps = `Step 1: Distribute (${distN}/${distD}).\n` +
                              `  (${distTermX_N}/${distTermX_D})x + ${distTermC_N}/${distTermC_D} + ${const1N}/${const1D} = ${const2N}/${const2D}\n\n` +
                              `Step 2: Combine constant terms on the left.\n`+
                              `  (${distTermX_N}/${distTermX_D})x + ${combinedConstN}/${combinedConstD} = ${const2N}/${const2D}\n\n`+
                              `Step 3: Subtract ${combinedConstN}/${combinedConstD} from both sides.\n`+
                              `  (${distTermX_N}/${distTermX_D})x = ${rhsN}/${rhsD}\n\n`+
                              `Step 4: Multiply by the reciprocal of (${distTermX_N}/${distTermX_D}).\n`+
                              `  x = (${rhsN}/${rhsD}) * (${distTermX_D}/${distTermX_N})\n` +
                              `  x = ${answer}`;

                return { instruction: "Solve the equation:", question, type: 'solve', answer, steps };
            },
            solveBasic: () => {
                const a = randInt(2, 8); let c = randInt(-8, -2);
                while (a === c) c = randInt(-8,-2);
                const x = randInt(-5, 5); const b = randInt(1, 10);
                const d = a*x + b - c*x;
                const question = `${a}x + ${b} = ${c}x + ${d}`;
                const answer = x.toString();
                const steps = `Step 1: Move variable terms to one side.\n  ${a-c}x + ${b} = ${d}\n`+
                              `Step 2: Isolate the variable term.\n  ${a-c}x = ${d-b}\n`+
                              `Step 3: Solve for x.\n  x = ${answer}`;
                return { instruction: "Solve the equation:", question, type: 'solve', answer, steps };
            },
            classify: (type) => {
                // For "one solution", keep it simple as it's a different skill check
                if (type === 'one') {
                    const a = randInt(2, 5), b = randInt(2, 5), c = randInt(2, 5), d = randInt(2, 5);
                    const e = a * b + randInt(1, 5);
                    const question = `${a}(${b}x + ${c}) = ${e}x + ${d}`;
                    const answer = 'one';
                    const explanation = `The coefficients of x (${a*b} and ${e}) are different, so there is one solution.`;
                    const steps = `Step 1: Distribute on the left side.\n  ${a*b}x + ${a*c} = ${e}x + ${d}\nStep 2: Simplify.\n  ${explanation}`;
                    return { instruction: "State whether the equation has one solution, no solution, or infinitely many solutions.", question, type: 'classify', answer, steps };
                }

                // --- Generate complex no/infinite solutions ---
                // LHS structure: a(bx+c) + dx
                const a = randInt(2, 5);
                const b = randInt(2, 5);
                const c = randInt(1, 5);
                const d = randInt(-4, 4); 
                const finalXCoeff = a * b + d; // Final x-coefficient for both sides
                const finalConstLHS = a * c;     // Final constant on LHS

                // RHS structure: e(fx+g) + hx + k
                const e = randInt(2, 5);
                const f = randInt(2, 5);
                const g = randInt(1, 5);

                let question, answer, explanation, steps;

                // Helper to format terms with signs for building the equation string
                const formatTerm = (val, isX) => {
                    if (val === 0) return '';
                    const sign = val > 0 ? ' + ' : ' - ';
                    const num = Math.abs(val);
                    const x = isX ? 'x' : '';
                    if (num === 1 && isX) return `${sign}${x}`;
                    return `${sign}${num}${x}`;
                };
                
                // Build the left side of the equation
                let lhs = `${a}(${b}x + ${c})${formatTerm(d, true)}`;
                const lhsSimplified = `${finalXCoeff}x${formatTerm(finalConstLHS, false)}`;

                if (type === 'infinite') {
                    // Make RHS simplify to the same expression as LHS
                    const h = finalXCoeff - (e * f);
                    const k = finalConstLHS - (e * g);
                    
                    let rhs = `${e}(${f}x + ${g})${formatTerm(h, true)}${formatTerm(k, false)}`;
                    const rhsSimplified = `${finalXCoeff}x${formatTerm(finalConstLHS, false)}`;

                    question = `${lhs} = ${rhs}`;
                    answer = 'infinite';
                    explanation = `Both sides simplify to ${lhsSimplified.replace(' + -', ' - ')}, which is always true.`;
                    steps = `Left Side:\n  ${lhs}\n  => ${a*b}x + ${a*c}${formatTerm(d, true)}\n  => ${lhsSimplified.replace(' + -', ' - ')}\n\n` +
                            `Right Side:\n  ${rhs}\n  => ${e*f}x + ${e*g}${formatTerm(h, true)}${formatTerm(k, false)}\n  => ${rhsSimplified.replace(' + -', ' - ')}\n\n` +
                            `Result:\n  The simplified equation is a true statement, so there are infinitely many solutions.`;

                } else { // type === 'no'
                    let finalConstRHS;
                    do {
                       finalConstRHS = finalConstLHS + randInt(1, 5) * (randInt(0, 1) ? 1 : -1);
                    } while (finalConstRHS === finalConstLHS); // Ensure constants are different

                    const h = finalXCoeff - (e * f);
                    const k = finalConstRHS - (e * g);

                    let rhs = `${e}(${f}x + ${g})${formatTerm(h, true)}${formatTerm(k, false)}`;
                    const rhsSimplified = `${finalXCoeff}x${formatTerm(finalConstRHS, false)}`;

                    question = `${lhs} = ${rhs}`;
                    answer = 'no';
                    explanation = `The equation simplifies to ${lhsSimplified.replace(' + -', ' - ')} = ${rhsSimplified.replace(' + -', ' - ')}, which is never true.`;
                    steps = `Left Side:\n  ${lhs}\n  => ${a*b}x + ${a*c}${formatTerm(d, true)}\n  => ${lhsSimplified.replace(' + -', ' - ')}\n\n` +
                            `Right Side:\n  ${rhs}\n  => ${e*f}x + ${e*g}${formatTerm(h, true)}${formatTerm(k, false)}\n  => ${rhsSimplified.replace(' + -', ' - ')}\n\n` +
                            `Result:\n  The simplified equation is a false statement, so there is no solution.`;
                }

                // Clean up leading ' + ' signs and double spaces from generated strings
                question = question.replace('=  +', '= ').replace('=  -', '= -');
                if (question.startsWith(' + ')) question = question.substring(3);
                
                return { instruction: "State whether the equation has one solution, no solution, or infinitely many solutions.", question, type: 'classify', answer, steps };
            }
        };

        let quizData = [];

        function generateNewQuiz() {
            let newQuestions = [];
            newQuestions.push(questionGenerators.solveDistributive());
            newQuestions.push(questionGenerators.solveFractions());
            newQuestions.push(questionGenerators.solveBasic());
            newQuestions.push(questionGenerators.solveFractionDistributive()); // New challenging question
            newQuestions.push(questionGenerators.classify('infinite'));
            newQuestions.push(questionGenerators.classify('no'));
            newQuestions.push(questionGenerators.classify('one'));
            newQuestions.push(questionGenerators.solveDistributive());
            newQuestions.push(questionGenerators.classify('infinite'));
            newQuestions.push(questionGenerators.solveFractions());

            quizData = shuffle(newQuestions);
        }

        // --- DOM ELEMENTS AND EVENT LISTENERS (No changes below this line) ---
        const questionArea = document.getElementById('question-area');
        const resultsArea = document.getElementById('results-area');
        const instructionEl = document.getElementById('question-instruction');
        const questionEl = document.getElementById('question-text');
        const solveArea = document.getElementById('solve-input-area');
        const answerInput = document.getElementById('answer-input');
        const classifyArea = document.getElementById('classify-options-area');
        const optionButtons = classifyArea.querySelectorAll('.option-btn');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const feedbackEl = document.getElementById('feedback-area');
        const scoreEl = document.getElementById('score-text');
        const finalMessageEl = document.getElementById('final-message');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');

        let currentQuestionIndex = 0;
        let score = 0;
        let selectedOption = null;

        function loadQuestion() {
            feedbackEl.classList.add('hidden');
            checkBtn.classList.remove('hidden');
            nextBtn.classList.add('hidden');
            answerInput.value = '';
            answerInput.disabled = false;
            selectedOption = null;
            optionButtons.forEach(btn => {
                btn.classList.remove('selected');
                btn.disabled = false;
            });
            
            if (currentQuestionIndex >= quizData.length) {
                showResults();
                return;
            }

            const progressPercentage = ((currentQuestionIndex) / quizData.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            progressText.textContent = `Question ${currentQuestionIndex + 1} / ${quizData.length}`;

            const currentQuestion = quizData[currentQuestionIndex];
            instructionEl.textContent = currentQuestion.instruction;
            questionEl.textContent = currentQuestion.question;

            if (currentQuestion.type === 'solve') {
                solveArea.classList.remove('hidden');
                classifyArea.classList.add('hidden');
                answerInput.focus();
            } else {
                solveArea.classList.add('hidden');
                classifyArea.classList.remove('hidden');
            }
        }
        
        function handleOptionClick(e) {
            selectedOption = e.target.dataset.value;
            optionButtons.forEach(btn => btn.classList.remove('selected'));
            e.target.classList.add('selected');
        }

        function checkAnswer() {
            const currentQuestion = quizData[currentQuestionIndex];
            let userAnswer = (currentQuestion.type === 'solve') ? answerInput.value.trim() : selectedOption;
            
            if (!userAnswer) {
                feedbackEl.innerHTML = 'Please provide an answer.';
                feedbackEl.className = 'mt-4 p-4 rounded-md text-center feedback-incorrect';
                return;
            }

            const isCorrect = userAnswer === currentQuestion.answer;

            feedbackEl.classList.remove('hidden');
            if (isCorrect) {
                score++;
                feedbackEl.innerHTML = "Correct!";
                feedbackEl.className = 'mt-4 p-4 rounded-md text-center feedback-correct';
            } else {
                let feedbackHTML = `Incorrect. The correct answer is <strong>${currentQuestion.answer}</strong>.` +
                                   `<div class="solution-steps"><strong>Solution:</strong>\n${currentQuestion.steps}</div>`;
                feedbackEl.innerHTML = feedbackHTML;
                feedbackEl.className = 'mt-4 p-4 rounded-md text-center feedback-incorrect';
            }

            answerInput.disabled = true;
            optionButtons.forEach(btn => btn.disabled = true);
            checkBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
        }

        function showResults() {
            questionArea.classList.add('hidden');
            resultsArea.classList.remove('hidden');
            document.getElementById('quiz-header').classList.add('hidden');
            
            scoreEl.textContent = `${score} / ${quizData.length}`;
            const percentage = Math.round((score / quizData.length) * 100);

            if (percentage >= 80) {
                finalMessageEl.textContent = "Excellent work! You've got a great grasp of these concepts.";
                scoreEl.classList.add('text-green-600');
            } else if (percentage >= 60) {
                finalMessageEl.textContent = "Good job! A little more practice will make perfect.";
                scoreEl.classList.add('text-yellow-500');
            } else {
                finalMessageEl.textContent = "Keep practicing! Reviewing the concepts will help a lot.";
                scoreEl.classList.add('text-red-600');
            }
        }
        
        function restartQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            resultsArea.classList.add('hidden');
            questionArea.classList.remove('hidden');
            document.getElementById('quiz-header').classList.remove('hidden');
            scoreEl.className = 'text-4xl font-bold mt-4'; 
            generateNewQuiz();
            loadQuestion();
        }

        checkBtn.addEventListener('click', checkAnswer);
        nextBtn.addEventListener('click', () => { currentQuestionIndex++; loadQuestion(); });
        restartBtn.addEventListener('click', restartQuiz);
        optionButtons.forEach(button => button.addEventListener('click', handleOptionClick));
        answerInput.addEventListener('keyup', (event) => { if (event.key === 'Enter') checkAnswer(); });

        generateNewQuiz();
        loadQuestion();
    </script>
</body>
</html>





