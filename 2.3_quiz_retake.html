<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Exponents Escape Room — Student Mode</title>
<!-- KaTeX (CDN) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false}
        ]});"
></script>
<style>
  :root{ --bg:#ffffff; --fg:#111827; --muted:#6b7280; --ok:#059669; --bad:#dc2626; --card:#f9fafb; --brand:#0ea5e9; }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
  header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid #e5e7eb;}
  .wrap{max-width:980px;margin:0 auto;padding:16px 20px;}
  h1{font-size:clamp(22px,2.2vw,30px);margin:6px 0 2px}
  p.sub{margin:0 0 8px;color:var(--muted)}
  .rooms{display:grid;grid-template-columns:1fr;gap:18px;margin:22px 0 40px}
  @media (min-width:900px){.rooms{grid-template-columns:1fr 1fr}}
  .room{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.04)}
  .room .title{display:flex;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid #e5e7eb}
  .badge{font-size:12px;color:white;background:var(--brand);padding:2px 8px;border-radius:999px}
  .content{padding:14px 16px}
  .problem{display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:center;padding:10px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;margin-bottom:10px}
  .idx{font-weight:700;color:#4b5563}
  .input-area{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type="text"]{flex:1;min-width:180px;padding:10px 12px;border-radius:10px;border:1px solid #d1d5db;font-size:15px}
  button.small{padding:8px 10px;border:1px solid #d1d5db;background:#fff;border-radius:10px;font-size:13px;cursor:pointer}
  button.small:hover{border-color:#9ca3af}
  .feedback{font-size:13px}
  .ok{color:var(--ok)}
  .bad{color:var(--bad)}
  .room-footer{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-top:1px solid #e5e7eb;background:#fff;border-bottom-left-radius:16px;border-bottom-right-radius:16px}
  .lock{font-weight:600;color:#6b7280}
  .unlock{color:var(--ok);font-weight:700}
  .pill{padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#fff;color:#374151;font-size:13px}
  .help{color:#374151}
  .katex{font-size:1.1em}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Exponents Escape Room — Student Mode</h1>
      <p class="sub">Solve 6 problems in a room to unlock the next. Enter simplified answers (no spaces). Use <strong>/</strong> for fractions and write variables with exponents like <code>x^5</code>.</p>
    </div>
  </header>

  <main class="wrap">
    <div class="rooms" id="rooms"></div>
  </main>

<script>
function tex(s){return s}

const ROOMS = [
  {
    name: 'Room 1 — Powers & Basics',
    blurb: 'Powers of fractions/integers and special bases',
    problems: [
      {q: '(4/5)^3', ans: '64/125'},
      {q: '(-3/4)^4', ans: '81/256'},
      {q: '(-3x)^5', ans: '-243x^5'},
      {q: '-3^6', ans: '-729'},
      {q: '(-1)^{542}', ans: '1'},
      {q: '(-1)^{9875}', ans: '-1'},
    ]
  },
  {
    name: 'Room 2 — Multiply Like Bases',
    blurb: 'Use a^m · a^n = a^{m+n}',
    problems: [
      {q: 'x^{10}\\cdot x^{7}', ans: 'x^17'},
      {q: 'm^{9}\\cdot m^{5}', ans: 'm^14'},
      {q: '5a^{2}\\cdot(-3a^{4})', ans: '-15a^6'},
      {q: '(-2y^{3})\\cdot4y^{6}', ans: '-8y^9'},
      {q: '7p^{5}\\cdot(-2p^{8})', ans: '-14p^13'},
      {q: '(-6x^{7})\\cdot5x^{2}', ans: '-30x^9'},
    ]
  },
  {
    name: 'Room 3 — Divide Like Bases',
    blurb: 'Use a^m / a^n = a^{m-n} (a≠0)',
    problems: [
      {q: '\\dfrac{12x^{15}}{4x^{9}}', ans: '3x^6'},
      {q: '\\dfrac{8y^{14}}{2y^{5}}', ans: '4y^9'},
      {q: '\\dfrac{10m^{7}}{-5m^{3}}', ans: '-2m^4'},
      {q: '\\dfrac{-9a^{20}}{3a^{12}}', ans: '-3a^8'},
      {q: '\\dfrac{14b^{9}}{-7b^{6}}', ans: '-2b^3'},
      {q: '\\dfrac{25x^{18}}{5x^{8}}', ans: '5x^10'},
    ]
  },
  {
    name: 'Room 4 — Combine Rules',
    blurb: 'Powers, products, and fractions together',
    problems: [
      {q: '(2b^{3})^{2}', ans: '4b^6'},
      {q: '(-3x^{4})^{3}', ans: '-27x^12'},
      {q: '(-5y^{6})^{2}', ans: '25y^12'},
      {q: '(-3x^{2}y^{3})\\cdot2x^{4}y^{5}', ans: '-6x^6y^8'},
      {q: '\\left(-\\tfrac{4}{7}x^{2}y^{5}\\right)\\left(\\tfrac{14}{5}x^{6}y^{2}\\right)', ans: '-8/5*x^8*y^7'},
      {q: '\\left(-\\tfrac{2}{3}a^{3}b^{4}\\right)\\left(\\tfrac{9}{4}a^{5}b^{2}\\right)', ans: '-3/2*a^8*b^6'},
    ]
  }
];

function roomHTML(roomIndex){
  const r = ROOMS[roomIndex];
  return `
    <section class="room" data-room="${roomIndex}">
      <div class="title">
        <span class="badge">${roomIndex+1}/4</span>
        <div>
          <div style="font-weight:700">${r.name}</div>
          <div class="help">${r.blurb}</div>
        </div>
      </div>
      <div class="content">
        ${r.problems.map((p,i)=>`
          <div class="problem" data-i="${i}">
            <div class="idx">${i+1}.</div>
            <div>
              <div class="q">$${p.q}$</div>
              <div class="input-area">
                <input type="text" placeholder="type your simplified answer" />
                <button class="small check">Check</button>
                <span class="feedback"></span>
              </div>
            </div>
          </div>
        `).join('')}
      </div>
      <div class="room-footer">
        <span class="lock">Solve all 6 to unlock next room.</span>
        <button class="small pill summary">Room Progress</button>
      </div>
    </section>`
}

// --- Input normalization & checking ---
function normalize(input){
  let s = (input||'').trim().replace(/\s+/g,'');
  s = s.replace(/(\d)([a-zA-Z])/g,'$1*$2');
  s = s.replace(/([a-zA-Z])(\d)/g,'$1*$2');
  const parts = s.split('*').filter(Boolean);
  let coeff = '1';
  const vars = [];
  for(const p of parts){
    if(/^[+-]?(\d+)(\/\d+)?$/.test(p)){
      coeff = mulFrac(coeff,p);
    }else{
      vars.push(p);
    }
  }
  vars.sort((a,b)=>a.localeCompare(b));
  const joined = (coeff==='1'? '' : coeff==='-1'? '-' : coeff)+'*'+vars.join('*');
  return joined.replace(/^\*|\*$/g,'');
}
function mulFrac(a,b){
  function toFrac(x){
    let sign = 1; if(x.startsWith('-')){sign=-1; x=x.slice(1);} else if(x.startsWith('+')){x=x.slice(1)}
    let n,d; if(x.includes('/')){[n,d]=x.split('/').map(Number)} else {n=Number(x); d=1}
    return {n:sign*n,d};
  }
  function reduce({n,d}){ const g=gcd(Math.abs(n),Math.abs(d)); n/=g; d/=g; if(d<0){d*=-1;n*=-1} return {n,d}; }
  const A=toFrac(a), B=toFrac(b); const r=reduce({n:A.n*B.n,d:A.d*B.d});
  return r.d===1? String(r.n) : `${r.n}/${r.d}`;
}
function gcd(a,b){return b?gcd(b,a%b):a}
function correct(expected,input){ return normalize(expected)===normalize(input); }

function build(){
  const container = document.getElementById('rooms');
  container.innerHTML = ROOMS.map((_,i)=>roomHTML(i)).join('');
  const sections = [...container.querySelectorAll('.room')];
  sections.forEach((sec,idx)=>{ if(idx>0){sec.style.opacity=.5; sec.style.pointerEvents='none'} });
  sections.forEach((sec,roomIdx)=>{
    sec.addEventListener('click', (e)=>{
      if(!(e.target instanceof HTMLElement)) return;
      if(e.target.classList.contains('check')){
        const probEl = e.target.closest('.problem');
        const i = Number(probEl.dataset.i);
        const ans = ROOMS[roomIdx].problems[i].ans;
        const input = probEl.querySelector('input').value;
        const fb = probEl.querySelector('.feedback');
        if(correct(ans,input)){
          fb.textContent = 'Correct!'; fb.className='feedback ok'; probEl.style.borderColor = '#86efac';
        }else{
          fb.textContent = 'Try again'; fb.className='feedback bad'; probEl.style.borderColor = '#fecaca';
        }
        checkUnlock(roomIdx);
      }
      if(e.target.classList.contains('summary')){
        const states = [...sec.querySelectorAll('.problem')].map(p=>p.querySelector('.feedback').classList.contains('ok'));
        const solved = states.filter(Boolean).length;
        alert(`${ROOMS[roomIdx].name}: ${solved}/6 solved`);
      }
    });
  });
}

function checkUnlock(roomIdx){
  const container = document.getElementById('rooms');
  const sections = [...container.querySelectorAll('.room')];
  const sec = sections[roomIdx];
  const solved = [...sec.querySelectorAll('.feedback.ok')].length;
  if(solved===6 && roomIdx < sections.length-1){
    const next = sections[roomIdx+1];
    next.style.opacity=1; next.style.pointerEvents='auto';
    const footer = sec.querySelector('.room-footer .lock');
    if(footer){footer.textContent='Room cleared! Next room unlocked.'; footer.className='unlock'}
  }
}

build();
</script>
</body>
</html>
