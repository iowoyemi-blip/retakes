<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluating Functions Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .quiz-container {
            transition: all 0.3s ease-in-out;
        }
        .result-item.correct {
            background-color: #f0fdf4;
            border-left-color: #22c55e;
        }
        .result-item.incorrect {
            background-color: #fef2f2;
            border-left-color: #ef4444;
        }
        .question-prefix {
            font-weight: 500;
            flex-shrink: 0;
        }
        .data-table {
            border-collapse: collapse;
            margin: 1rem auto;
        }
        .data-table th, .data-table td {
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            text-align: center;
        }
        .data-table th {
            background-color: #f3f4f6;
        }
        canvas {
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-lg w-full max-w-4xl quiz-container">
        <div class="p-8 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800">3.2 Quiz Evaluating Functions Retake (Take Two in A Row)</h1>
            <p class="text-gray-600 mt-2">Generate a new quiz anytime.</p>
        </div>

        <div id="quizContainer" class="p-8">
            <!-- The quiz form will be dynamically generated and inserted here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Quiz Results</h2>
            <div id="score" class="text-xl mb-6 font-semibold"></div>
            <div id="detailedResults" class="space-y-4"></div>
             <div class="mt-8 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="retakeQuizBtn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700 transition-transform transform hover:scale-105">Try This Quiz Again</button>
                <button id="generateNewBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105">Generate New Quiz</button>
            </div>
        </div>
    </main>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        const resultsSection = document.getElementById('resultsSection');
        const scoreElement = document.getElementById('score');
        const detailedResultsElement = document.getElementById('detailedResults');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const generateNewBtn = document.getElementById('generateNewBtn');

        let currentQuestions = [];

        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);

        function generateQuizData() {
            let questions = [];
            
            // Q1: Evaluate from equation
            const m1 = getRandomInt(-4, 4) || 1; // avoid 0
            const b1 = getRandomInt(-10, 10);
            const x1a = getRandomInt(-3, 3);
            const x1b = getRandomInt(-3, 3);
            const x1c_sol = getRandomInt(-5, 5);
            const f_x1c = m1 * x1c_sol + b1;
            questions.push({
                type: 'equation', id: 'q1',
                text: `Given f(x) = ${m1}x ${b1 >= 0 ? '+' : '-'} ${Math.abs(b1)} determine:`,
                subQuestions: [
                    { id: 'q1a', text: `f(${x1a})`, answer: (m1 * x1a + b1).toString() },
                    { id: 'q1b', text: `f(x) = ${f_x1c}`, answer: x1c_sol.toString() }
                ]
            });

            // Q2: Evaluate from table
            const x_vals = shuffle([1, 2, 3, 4, 5, 6, 7]).slice(0, 5);
            const h_vals = x_vals.map(() => getRandomInt(1, 15));
            const tableData = x_vals.map((x, i) => ({ x, h: h_vals[i] }));
            const [q2a_x1, q2a_x2] = shuffle(x_vals).slice(0, 2);
            const q2b_h = shuffle(h_vals)[0];
            const q2b_x = tableData.find(d => d.h === q2b_h).x;
            questions.push({
                type: 'table', id: 'q2', text: 'Consider the following table of values for h(x):',
                data: tableData,
                subQuestions: [
                    { id: 'q2a', text: `h(${q2a_x1}) - h(${q2a_x2})`, answer: (tableData.find(d=>d.x===q2a_x1).h - tableData.find(d=>d.x===q2a_x2).h).toString() },
                    { id: 'q2b', text: `h(x) = ${q2b_h}`, answer: q2b_x.toString() }
                ]
            });
            
            // Q3: Evaluate from graph, ensuring points are on the grid
            let m3, b3, x3a, y3a, x3b, y3b;
            
            // Loop to ensure the line is reasonably placed and doesn't produce off-grid values for questions
            do {
                m3 = getRandomInt(-2, 2) || 1; // Keep slope gentle
                b3 = getRandomInt(-3, 3);     // Keep y-intercept close to origin
                x3a = getRandomInt(-4, 4);
                y3a = m3 * x3a + b3;
                
                // Find a different x for the second question
                let temp_x3b;
                do {
                    temp_x3b = getRandomInt(-4, 4);
                } while (temp_x3b === x3a);
                x3b = temp_x3b;
                y3b = m3 * x3b + b3;

            } while (Math.abs(y3a) > 5 || Math.abs(y3b) > 5); // Regenerate if points are off-grid

            questions.push({
                type: 'graph', id: 'q3', text: 'The graph of y = f(x) is shown below. Determine the values represented below the graph.',
                data: { m: m3, b: b3 },
                subQuestions: [
                     { id: 'q3a', text: `f(${x3a})`, answer: y3a.toString() },
                     { id: 'q3b', text: `f(x) = ${y3b}`, answer: x3b.toString() }
                ]
            });

            currentQuestions = questions;
        }

        function drawGraph() {
            const graphData = currentQuestions.find(q => q.type === 'graph').data;
            const { m, b } = graphData;
            
            const canvas = document.getElementById('linearGraph');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            const width = canvas.width;
            const height = canvas.height;
            const scale = 30;
            const originX = width / 2;
            const originY = height / 2;

            ctx.clearRect(0, 0, width, height);

            // Draw grid
            ctx.strokeStyle = '#d1d5db'; // A darker, more visible gray
            ctx.lineWidth = 1;
            for (let i = scale; i < width; i += scale) { // Vertical lines
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, height);
                ctx.stroke();
            }
            for (let i = scale; i < height; i += scale) { // Horizontal lines
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(width, i);
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(0, originY); ctx.lineTo(width, originY); // X-axis
            ctx.moveTo(originX, 0); ctx.lineTo(originX, height); // Y-axis
            ctx.stroke();

            // Draw labels
            ctx.fillStyle = '#6b7280';
            ctx.font = '10px Inter';
            for (let i = -5; i <= 5; i++) {
                if (i === 0) continue;
                ctx.fillText(i, originX + i * scale - 3, originY + 12);
                ctx.fillText(i, originX - 12, originY - i * scale + 3);
            }

            // Draw the line
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            const x_min = -5;
            const y_min = m * x_min + b;
            ctx.moveTo(originX + x_min * scale, originY - y_min * scale);
            const x_max = 5;
            const y_max = m * x_max + b;
            ctx.lineTo(originX + x_max * scale, originY - y_max * scale);
            ctx.stroke();
        }

        function renderQuizForm() {
            let html = '<form id="quizForm">';
            currentQuestions.forEach(q => {
                html += `<div class="mb-10"><h2 class="text-xl font-semibold text-gray-700 mb-6">${q.id.toUpperCase()}. ${q.text}</h2>`;
                if(q.type === 'equation' || q.type === 'table') {
                    if (q.type === 'table') {
                        html += `<table class="data-table"><thead><tr><th>x</th>${q.data.map(d=>`<td>${d.x}</td>`).join('')}</tr>
                                 <tr><th>h(x)</th>${q.data.map(d=>`<td>${d.h}</td>`).join('')}</tr></thead></table>`;
                    }
                    html += `<div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">`;
                    q.subQuestions.forEach((sq, i) => {
                         html += `<div><label for="${sq.id}" class="block mb-1">${String.fromCharCode(97+i)}) ${sq.text}</label>
                                  <input type="text" id="${sq.id}" class="w-full p-2 border rounded-lg"></div>`;
                    });
                    html += `</div>`;
                } else if (q.type === 'graph') {
                    html += `<div class="flex flex-col md:flex-row gap-8 items-center">
                                <canvas id="linearGraph" width="300" height="300"></canvas>
                                <div class="flex-grow space-y-4">`;
                    q.subQuestions.forEach((sq, i) => {
                         html += `<div><label for="${sq.id}" class="block mb-1">${String.fromCharCode(97+i)}) ${sq.text}</label>
                                  <input type="text" id="${sq.id}" class="w-full p-2 border rounded-lg"></div>`;
                    });
                    html += `</div></div>`;
                }
                html += `</div>`;
            });
            html += `<div class="mt-10 text-center"><button type="submit" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg">Grade My Quiz</button></div></form>`;
            quizContainer.innerHTML = html;
            
            if (currentQuestions.some(q => q.type === 'graph')) {
                drawGraph();
            }

            document.getElementById('quizForm').addEventListener('submit', gradeQuiz);
        }

        function gradeQuiz(event) {
            event.preventDefault();
            let score = 0, total = 0;
            let resultsHTML = '';
            
            currentQuestions.forEach(q => {
                q.subQuestions.forEach(sq => {
                    total++;
                    const userInput = document.getElementById(sq.id).value.trim();
                    const isCorrect = userInput === sq.answer;
                    if(isCorrect) score++;

                     resultsHTML += `<div class="result-item border-l-4 p-4 rounded-md ${isCorrect ? 'correct' : 'incorrect'}">
                        <div class="font-semibold text-gray-800">${q.text} <span class="font-normal italic">- Part: ${sq.text}</span></div>
                        <p class="mt-2 text-sm">Your answer: <span class="font-medium ${isCorrect ? 'text-green-700' : 'text-red-700'}">${userInput || '<i>No answer</i>'}</span></p>
                        ${!isCorrect ? `<p class="mt-1 text-sm">Correct answer: <span class="font-medium text-green-700">${sq.answer}</span></p>` : ''}
                    </div>`;
                });
            });

            const percentage = Math.round((score / total) * 100);
            let scoreColor = percentage >= 80 ? 'text-green-600' : (percentage >= 60 ? 'text-yellow-600' : 'text-red-600');
            scoreElement.innerHTML = `Your Score: <span class="${scoreColor}">${score} out of ${total} (${percentage}%)</span>`;
            detailedResultsElement.innerHTML = resultsHTML;
            quizContainer.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }
        
        retakeQuizBtn.addEventListener('click', () => {
            renderQuizForm();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            window.scrollTo(0, 0);
        });
        generateNewBtn.addEventListener('click', () => {
            generateQuizData();
            renderQuizForm();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            window.scrollTo(0, 0);
        });
        document.addEventListener('DOMContentLoaded', () => {
             generateQuizData();
             renderQuizForm();
        });
    </script>
</body>
</html>


