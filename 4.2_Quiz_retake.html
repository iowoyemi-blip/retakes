<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing Linear Equations Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .quiz-container {
            transition: all 0.3s ease-in-out;
        }
        .result-item.correct {
            background-color: #f0fdf4;
            border-left-color: #22c55e;
        }
        .result-item.incorrect {
            background-color: #fef2f2;
            border-left-color: #ef4444;
        }
        .question-prefix {
            font-weight: 500;
            flex-shrink: 0;
        }
        canvas {
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-lg w-full max-w-4xl quiz-container">
        <div class="p-8 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800">4.2 Quiz Writing Linear Equations Retake</h1>
            <p class="text-gray-600 mt-2">Generate a new quiz anytime. Write all answers in slope-intercept form (y=mx+b) unless otherwise specified.</p>
        </div>

        <div id="quizContainer" class="p-8">
            <!-- The quiz form will be dynamically generated and inserted here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Quiz Results</h2>
            <div id="score" class="text-xl mb-6 font-semibold"></div>
            <div id="detailedResults" class="space-y-4"></div>
             <div class="mt-8 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="retakeQuizBtn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700">Try This Quiz Again</button>
                <button id="generateNewBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700">Generate New Quiz</button>
            </div>
        </div>
    </main>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        const resultsSection = document.getElementById('resultsSection');
        const scoreElement = document.getElementById('score');
        const detailedResultsElement = document.getElementById('detailedResults');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const generateNewBtn = document.getElementById('generateNewBtn');

        let currentQuestions = [];

        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
        const gcd = (a, b) => { a=Math.abs(a); b=Math.abs(b); return b === 0 ? a : gcd(b, a % b); }

        function simplifyFrac(num, den) {
            if (den === 0) return "undefined";
            if (num === 0) return "0";
            const commonDivisor = gcd(num, den);
            let n = num / commonDivisor;
            let d = den / commonDivisor;
            if (d < 0) { n = -n; d = -d; }
            return d === 1 ? `${n}` : `${n}/${d}`;
        }

        function formatB(b_str) {
            if (b_str.includes('/')) {
                if (b_str.startsWith('-')) {
                    return b_str;
                }
                return `+${b_str}`;
            }
            const b_num = parseFloat(b_str);
            if (b_num === 0) return '';
            return b_num > 0 ? `+${b_num}` : `${b_num}`;
        }

        function generateQuizData() {
            let questions = [];
            
            // Q1: Point-Slope
            const q1_m_num = getRandomInt(-4, 4) || 1; const q1_m_den = getRandomInt(2, 5);
            const q1_m_str = simplifyFrac(q1_m_num, q1_m_den);
            const q1_x = getRandomInt(-5, 5); const q1_y = getRandomInt(-5, 5);
            const q1_b_val = q1_y - (q1_m_num / q1_m_den) * q1_x;
            const q1_b_str = simplifyFrac(Math.round(q1_b_val * q1_m_den), q1_m_den);
            questions.push({ type: 'single-input', id: 'q1', title: 'What is the equation in slope-intercept form?',
                text: `The line passes through the point (${q1_x}, ${q1_y}) and has the slope of ${q1_m_str}.`,
                answer: `y=${q1_m_str}x${formatB(q1_b_str)}`
            });
            
            // Q2: Two Points
            const q2_x1 = getRandomInt(-5, 5); let q2_x2 = getRandomInt(-5, 5);
            if (q2_x1 === q2_x2) q2_x2++;
            const q2_y1 = getRandomInt(-5, 5); const q2_y2 = getRandomInt(-5, 5);
            const q2_m_num = q2_y2 - q2_y1; const q2_m_den = q2_x2 - q2_x1;
            const q2_m_str = simplifyFrac(q2_m_num, q2_m_den);
            const q2_b_val = q2_y1 - (q2_m_num / q2_m_den) * q2_x1;
            const q2_b_str = simplifyFrac(Math.round(q2_b_val * q2_m_den), q2_m_den);
            questions.push({ type: 'single-input', id: 'q2', title: 'Write equation in slope-intercept form.',
                text: `The line passes through the points (${q2_x1}, ${q2_y1}) and (${q2_x2}, ${q2_y2}).`,
                answer: `y=${q2_m_str}x${formatB(q2_b_str)}`
            });

            // Q3 & 4: Special Lines from Graph (will alternate)
            if (Math.random() > 0.5) { // Vertical
                const x_val = getRandomInt(-4,4);
                questions.push({type: 'graph-special', id: 'q3', title: 'Write the equation of the line and state the slope.', data: { type: 'vertical', val: x_val }, answers: { eq: `x=${x_val}`, slope: 'undefined' }});
            } else { // Horizontal
                const y_val = getRandomInt(-4,4);
                questions.push({type: 'graph-special', id: 'q3', title: 'Write the equation of the line and state the slope.', data: { type: 'horizontal', val: y_val }, answers: { eq: `y=${y_val}`, slope: '0' }});
            }

            if (questions.find(q=>q.id==='q3').data.type === 'vertical') { // Horizontal
                const y_val = getRandomInt(-4,4);
                questions.push({type: 'graph-special', id: 'q4', title: 'Write the equation of the line and state the slope.', data: { type: 'horizontal', val: y_val }, answers: { eq: `y=${y_val}`, slope: '0' }});
            } else { // Vertical
                const x_val = getRandomInt(-4,4);
                questions.push({type: 'graph-special', id: 'q4', title: 'Write the equation of the line and state the slope.', data: { type: 'vertical', val: x_val }, answers: { eq: `x=${x_val}`, slope: 'undefined' }});
            }
            
            // Q5: Perpendicular
            const q5_m_orig_num = getRandomInt(-3, 3) || 1; const q5_m_orig_den = getRandomInt(2, 4);
            const q5_b_orig = getRandomInt(-8, 8);
            const q5_m_perp_num = -q5_m_orig_den; const q5_m_perp_den = q5_m_orig_num;
            const q5_m_perp_str = simplifyFrac(q5_m_perp_num, q5_m_perp_den);
            const q5_x = getRandomInt(-5, 5); const q5_y = getRandomInt(-5, 5);
            const q5_b_val = q5_y - (q5_m_perp_num / q5_m_perp_den) * q5_x;
            const q5_b_str = simplifyFrac(Math.round(q5_b_val * q5_m_perp_den), q5_m_perp_den);
            questions.push({ type: 'single-input', id: 'q5', title: 'What is the equation in slope-intercept form?',
                text: `The line passes through the point (${q5_x}, ${q5_y}) and is <strong>perpendicular</strong> to the equation y = ${simplifyFrac(q5_m_orig_num, q5_m_orig_den)}x ${formatB(q5_b_orig.toString())}.`,
                answer: `y=${q5_m_perp_str}x${formatB(q5_b_str)}`
            });

            // Q6: Parallel
            const q6_m_orig_num = getRandomInt(-3, 3) || 1; const q6_m_orig_den = getRandomInt(2, 4);
            const q6_m_orig_str = simplifyFrac(q6_m_orig_num, q6_m_orig_den);
            const q6_b_orig = getRandomInt(-8, 8);
            const q6_x = getRandomInt(-5, 5); const q6_y = getRandomInt(-5, 5);
            const q6_b_val = q6_y - (q6_m_orig_num / q6_m_orig_den) * q6_x;
            const q6_b_str = simplifyFrac(Math.round(q6_b_val * q6_m_orig_den), q6_m_orig_den);
             questions.push({ type: 'single-input', id: 'q6', title: 'What is the equation in slope-intercept form?',
                text: `The line passes through the point (${q6_x}, ${q6_y}) and is <strong>parallel</strong> to the equation y = ${q6_m_orig_str}x ${formatB(q6_b_orig.toString())}.`,
                answer: `y=${q6_m_orig_str}x${formatB(q6_b_str)}`
            });

            currentQuestions = questions;
        }

        function drawGraph(canvasId, graphData) {
            const { type, val } = graphData;
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const { width, height, scale, originX, originY } = { width: 200, height: 200, scale: 20, originX: 100, originY: 100 };
            canvas.width = width; canvas.height = height;
            ctx.clearRect(0, 0, width, height);

            ctx.strokeStyle = '#d1d5db'; ctx.lineWidth = 1;
            for (let i = scale; i < width; i += scale) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, height); ctx.stroke(); }
            for (let i = scale; i < height; i += scale) { ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(width, i); ctx.stroke(); }
            
            ctx.strokeStyle = '#374151'; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(0, originY); ctx.lineTo(width, originY); ctx.moveTo(originX, 0); ctx.lineTo(originX, height); ctx.stroke();

            ctx.strokeStyle = '#3b82f6'; ctx.lineWidth = 2.5;
            ctx.beginPath();
            if (type === 'vertical') {
                ctx.moveTo(originX + val * scale, 0);
                ctx.lineTo(originX + val * scale, height);
            } else { // horizontal
                ctx.moveTo(0, originY - val * scale);
                ctx.lineTo(width, originY - val * scale);
            }
            ctx.stroke();
        }
        
        function renderQuizForm() {
            let html = '<form id="quizForm">';
            currentQuestions.forEach(q => {
                html += `<div class="mb-10"><h2 class="text-xl font-semibold text-gray-700 mb-6">${q.id.slice(1)}. ${q.title}</h2>`;
                if(q.type === 'single-input') {
                    html += `<div class="text-center"><p class="text-lg mb-4">${q.text}</p>
                            <input id="${q.id}" class="p-2 border rounded-lg" placeholder="y=mx+b"></div>`;
                } else if (q.type === 'graph-special') {
                    html += `<div class="flex flex-col md:flex-row items-center justify-center gap-8">
                                <canvas id="${q.id}_canvas"></canvas>
                                <div class="space-y-3">
                                    <div><label>Slope: </label><input id="${q.id}_slope" class="p-1 border rounded-lg w-32"></div>
                                    <div><label>Equation: </label><input id="${q.id}_eq" class="p-1 border rounded-lg w-32"></div>
                                </div>
                             </div>`;
                }
                html += `</div>`;
            });
            html += `<div class="mt-10 text-center"><button type="submit" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg">Grade My Quiz</button></div></form>`;
            quizContainer.innerHTML = html;
            
            currentQuestions.filter(q => q.type === 'graph-special').forEach(q => drawGraph(`${q.id}_canvas`, q.data));
            
            document.getElementById('quizForm').addEventListener('submit', gradeQuiz);
        }

        const normalizeEq = str => {
            let s = str.replace(/\s+/g, '').toLowerCase();
            // Handle y=-2/3x -4/3 vs y=-2/3x+-4/3
            s = s.replace('+-', '-');
            // Handle y=(-1/2)x+3 -> y=-1/2x+3
            s = s.replace(/\(\s*(-?\d+\/\d+)\s*\)/g, '$1');
            // Handle y=-x+1 -> y=-1x+1
            if (s.startsWith('y=-x')) {
                s = 'y=-1x' + s.substring(4);
            }
            // Handle y=x+1 -> y=1x+1
            if (s.startsWith('y=x')) {
                s = 'y=1x' + s.substring(3);
            }
            // Handle y=2x+0 -> y=2x
            if (s.endsWith('+0')) {
                s = s.slice(0, -2);
            }
            if (s.endsWith('-0')) {
                s = s.slice(0, -2);
            }
            return s;
        };
        const normalizeSlope = str => {
            const s = str.replace(/\s+/g, '').toLowerCase();
            if (s === 'undef' || s === 'undefined' || s === 'noslope') return 'undefined';
            return s;
        }

        function gradeQuiz(event) {
            event.preventDefault();
            let score = 0, total = 0, resultsHTML = '';
            
            currentQuestions.forEach(q => {
                if(q.type === 'single-input') {
                    total++;
                    const userInput = document.getElementById(q.id).value;
                    const isCorrect = normalizeEq(userInput) === normalizeEq(q.answer);
                    if (isCorrect) score++;
                     resultsHTML += `<div class="result-item border-l-4 p-4 ${isCorrect ? 'correct' : 'incorrect'}"><p>Question ${q.id.slice(1)}: Your Answer: ${userInput || 'none'}. ${!isCorrect ? `Correct: ${q.answer}` : ''}</p></div>`;
                } else if (q.type === 'graph-special') {
                    total += 2;
                    const slopeUser = document.getElementById(`${q.id}_slope`).value;
                    const eqUser = document.getElementById(`${q.id}_eq`).value;
                    
                    const slopeCorrect = normalizeSlope(slopeUser) === q.answers.slope;
                    const eqCorrect = normalizeEq(eqUser) === normalizeEq(q.answers.eq);
                    
                    if (slopeCorrect) score++;
                    if (eqCorrect) score++;

                    resultsHTML += `<div class="result-item border-l-4 p-4 ${slopeCorrect && eqCorrect ? 'correct' : 'incorrect'}"><p>Question ${q.id.slice(1)}:</p>
                                    <p class="text-sm ${slopeCorrect ? '' : 'text-red-500'}">Slope: ${slopeUser || 'none'}. ${!slopeCorrect ? `Correct: ${q.answers.slope}` : ''}</p>
                                    <p class="text-sm ${eqCorrect ? '' : 'text-red-500'}">Equation: ${eqUser || 'none'}. ${!eqCorrect ? `Correct: ${q.answers.eq}` : ''}</p></div>`;
                }
            });
            
            const percentage = total > 0 ? Math.round((score / total) * 100) : 0;
            let scoreColor = percentage >= 80 ? 'text-green-600' : (percentage >= 60 ? 'text-yellow-600' : 'text-red-600');
            scoreElement.innerHTML = `Your Score: <span class="${scoreColor}">${score} out of ${total} (${percentage}%)</span>`;
            detailedResultsElement.innerHTML = resultsHTML;
            quizContainer.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }
        
        retakeQuizBtn.addEventListener('click', () => {
            renderQuizForm();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });
        generateNewBtn.addEventListener('click', () => {
            generateQuizData();
            renderQuizForm();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });
        document.addEventListener('DOMContentLoaded', () => {
             generateQuizData();
             renderQuizForm();
        });
    </script>
</body>
</html>


