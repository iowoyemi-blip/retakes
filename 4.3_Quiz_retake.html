<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Linear Equations Dynamic Quiz</title>
<style>
    body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f0f4f8; color: #333; display: flex; justify-content: center; min-height: 100vh; padding: 20px; margin: 0; }
    .container { background: white; width: 100%; max-width: 700px; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .stats-bar { display: flex; justify-content: space-between; background: #e9ecef; padding: 10px 20px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; color: #555; }
    .question-box { font-size: 1.2em; margin-bottom: 20px; line-height: 1.5; }
    .math-text { font-weight: bold; font-family: monospace; background: #f8f9fa; padding: 2px 4px; border-radius: 4px; color: #2c3e50; }
    input[type="text"] { width: 100%; padding: 12px; font-size: 1.1em; border: 2px solid #ddd; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; }
    .mc-option { display: block; background: #f8f9fa; border: 2px solid #ddd; padding: 12px; margin-bottom: 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
    .mc-option:hover { background-color: #e2e6ea; }
    .mc-option.selected { background: #d4eaf7; border-color: #3498db; }
    .btn { background-color: #3498db; color: white; border: none; padding: 12px 24px; font-size: 1em; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold; transition: background 0.2s; }
    .btn:hover { background-color: #2980b9; }
    .feedback { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; animation: fadeIn 0.3s; }
    .feedback.correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .feedback.incorrect { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .solution { margin-top: 15px; padding-top: 15px; border-top: 1px solid #ccc; font-size: 0.95em; white-space: pre-wrap; line-height: 1.6; }
    
    /* CRITICAL VISIBILITY CLASS */
    .hidden { display: none !important; }
    
    .summary-score { font-size: 3em; text-align: center; color: #2c3e50; margin: 20px 0; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: #2c3e50;">Linear Equations Practice</h1>
    
    <div class="stats-bar">
        <span>Question: <span id="q-num">1</span>/<span id="total-q">8</span></span>
        <span>Correct: <span id="score-correct">0</span></span>
    </div>

    <div id="quiz-area">
        <div class="question-box" id="question-text"></div>
        <div class="input-area" id="input-container"></div>
        <button class="btn" id="submit-btn" onclick="checkAnswer()">Check Answer</button>
        <button class="btn hidden" id="next-btn" onclick="nextQuestion()">Next Question</button>
        <div class="feedback" id="feedback-area">
            <strong id="feedback-title"></strong>
            <div class="solution" id="solution-text"></div>
        </div>
    </div>

    <div id="summary-area" class="hidden">
        <h2 style="text-align:center">Quiz Complete!</h2>
        <div class="summary-score">Score: <span id="final-score"></span></div>
        <p style="text-align:center">Great job practicing linear equations!</p>
        <button class="btn" onclick="startNewQuiz()">Generate New Quiz (New Numbers)</button>
    </div>
</div>

<script>
    // --- UTILITY MATH FUNCTIONS ---
    function gcd(a, b) { return b === 0 ? a : gcd(b, a % b); }
    
    function simplifyFraction(num, den) {
        if (den === 0) return "undefined";
        if (num === 0) return "0";
        let sign = (num * den < 0) ? -1 : 1;
        num = Math.abs(num); den = Math.abs(den);
        let divisor = gcd(num, den);
        num /= divisor; den /= divisor;
        if (den === 1) return (sign * num).toString();
        return (sign === -1 ? "-" : "") + num + "/" + den;
    }

    function formatCoord(x, y) { return `(${x}, ${y})`; }
    
    function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    
    function randNonZero(min, max) {
        let n = 0;
        while(n === 0) n = randInt(min, max);
        return n;
    }

    // --- QUESTION GENERATORS ---
    let questions = [];
    let currentQIndex = 0;
    let score = 0;
    let selectedMCOption = null;

    // Q1: Point-Slope Form from two points
    function genQ1() {
        // Ensure integer slope for cleaner entry logic
        let x1 = randInt(-8, 8);
        let y1 = randInt(-8, 8);
        let rise = randNonZero(-5, 5);
        let run = randNonZero(-5, 5);
        // Avoid undefined slope
        if(run === 0) run = 1;
        
        let x2 = x1 + run;
        let y2 = y1 + rise;
        
        let slopeFrac = simplifyFraction(rise, run);
        let slopeVal = rise/run;
        
        // Expected answer logic for Point-Slope: y - y1 = m(x - x1)
        let ans = `y - ${y1} = ${slopeFrac}(x - ${x1})`;
        // FIX: Use Regex /g to replace ALL double negatives
        ans = ans.replace(/\- \-/g, "+ ").replace(/\+ \-/g, "- "); 
        
        // Simplified version for checking logic
        let cleanAns = ans.replace(/\s/g, '');

        return {
            type: 'text',
            text: `Write the equation of the line that passes through the points <span class="math-text">${formatCoord(x1, y1)}</span> and <span class="math-text">${formatCoord(x2, y2)}</span>. Leave your answer in <b>Point-Slope form</b> using the first point <span class="math-text">${formatCoord(x1, y1)}</span>.`,
            correctAnswer: cleanAns,
            solution: `1. Find the slope (m): (y2 - y1) / (x2 - x1)\n   m = (${y2} - ${y1}) / (${x2} - ${x1}) = ${rise}/${run} = ${slopeFrac}.\n2. Use Point-Slope form: y - y1 = m(x - x1)\n   Using point ${formatCoord(x1, y1)}:\n   ${ans}`
        };
    }

    // Q2: Slope of line parallel to Ax - By = C
    function genQ2() {
        let A = randInt(2, 9);
        let B = randInt(2, 9);
        let C = randInt(10, 50);
        let sign = Math.random() < 0.5 ? '-' : '+';
        let eq = `${A}x ${sign} ${B}y = ${C}`;
        
        let actualSlope = (sign === '-') ? simplifyFraction(A, B) : simplifyFraction(-A, B);
        
        return {
            type: 'text',
            text: `Find the <b>slope</b> of a line <b>parallel</b> to the line whose equation is <span class="math-text">${eq}</span>. Fully simplify your answer.`,
            correctAnswer: actualSlope,
            solution: `1. Parallel lines have the same slope.\n2. Convert ${eq} to slope-intercept form (y = mx + b).\n   ${sign === '-' ? -B : B}y = ${-A}x + ${C}\n   y = ${actualSlope}x + (intercept)\n3. The slope is ${actualSlope}.`
        };
    }

    // Q3: Slope of line perpendicular to Ax + By = C
    function genQ3() {
        let A = randInt(2, 8);
        let B = randInt(2, 8);
        let C = randInt(10, 40);
        let eq = `${A}x + ${B}y = ${C}`;
        
        let perpSlope = simplifyFraction(B, A);
        
        return {
            type: 'text',
            text: `Find the <b>slope</b> of a line <b>perpendicular</b> to the line whose equation is <span class="math-text">${eq}</span>.`,
            correctAnswer: perpSlope,
            solution: `1. Find the slope of the given line.\n   ${B}y = -${A}x + ${C}  ->  y = -${A}/${B}x + ...\n   Original slope m = -${A}/${B}.\n2. Perpendicular lines have negative reciprocal slopes.\n   Flip fraction and change sign: ${B}/${A}.\n   Simplified: ${perpSlope}.`
        };
    }

    // Q4: Equation of line through point perp to y = mx + b
    function genQ4() {
        let mNum = randNonZero(-3, 3);
        let mDen = 1;
        let b = randInt(1, 10);
        let x1 = randInt(-5, 5);
        let y1 = randInt(-5, 5);
        
        let eqGiven = `y = ${mNum}x + ${b}`;
        if (mNum === 1) eqGiven = `y = x + ${b}`;
        if (mNum === -1) eqGiven = `y = -x + ${b}`;

        let perpSlopeFrac = simplifyFraction(-1, mNum); 
        let perpSlopeVal = -1 / mNum;
        
        let ans = `y - ${y1} = ${perpSlopeFrac}(x - ${x1})`;
        // FIX: Use Regex /g to replace ALL double negatives
        ans = ans.replace(/\- \-/g, "+ ").replace(/\+ \-/g, "- ");
        let cleanAns = ans.replace(/\s/g, '');

        return {
            type: 'text',
            text: `What is an equation of the line that passes through <span class="math-text">${formatCoord(x1, y1)}</span> and is <b>perpendicular</b> to <span class="math-text">${eqGiven}</span>? (Write in Point-Slope Form).`,
            correctAnswer: cleanAns,
            solution: `1. Original slope m = ${mNum}.\n2. Perpendicular slope is negative reciprocal: ${perpSlopeFrac}.\n3. Use Point-Slope form with ${formatCoord(x1, y1)}:\n   y - y1 = m(x - x1)\n   ${ans}`
        };
    }

    // Q5: Equation through point parallel to fraction slope (Text)
    function genQ5() {
        let num = randNonZero(1, 4);
        let den = randInt(2, 5);
        let slope = simplifyFraction(-num, den);
        let b = randInt(1, 9);
        let x1 = randInt(2, 8);
        let y1 = randInt(-8, -2);
        
        let eq = `y = ${slope}x - ${b}`;
        
        let ans = `y - ${y1} = ${slope}(x - ${x1})`;
        // FIX: Use Regex /g to replace ALL double negatives
        ans = ans.replace(/\- \-/g, "+ ").replace(/\+ \-/g, "- ");
        let cleanAns = ans.replace(/\s/g, '');

        return {
            type: 'text',
            text: `What is an equation of the line that passes through <span class="math-text">${formatCoord(x1, y1)}</span> and is <b>parallel</b> to <span class="math-text">${eq}</span>? (Write in Point-Slope Form).`,
            correctAnswer: cleanAns,
            solution: `1. Parallel lines have the same slope: m = ${slope}.\n2. Use Point-Slope form with point ${formatCoord(x1, y1)}:\n   y - y1 = m(x - x1)\n   ${ans}`
        };
    }

    // Q6: Line through two points (Multiple Choice)
    function genQ6() {
        let m = randNonZero(-4, 4);
        let b = randInt(-5, 5);
        
        let x1 = randInt(0, 3);
        let y1 = m * x1 + b;
        let x2 = randInt(4, 7);
        let y2 = m * x2 + b;
        
        let correctEq = `y = ${m}x ${b >= 0 ? '+' : '-'} ${Math.abs(b)}`;
        let wrong1 = `y = ${-m}x ${b >= 0 ? '+' : '-'} ${Math.abs(b)}`;
        let wrong2 = `y = ${m}x ${b >= 0 ? '-' : '+'} ${Math.abs(b)}`;
        let wrong3 = `y = ${m}x ${b >= 0 ? '+' : '-'} ${Math.abs(b) + 2}`;

        let options = [correctEq, wrong1, wrong2, wrong3];
        options = options.sort(() => Math.random() - 0.5);

        return {
            type: 'mc',
            text: `Write equation of the line that passes through points <span class="math-text">${formatCoord(x1, y1)}</span> and <span class="math-text">${formatCoord(x2, y2)}</span>.`,
            options: options,
            correctAnswer: correctEq,
            solution: `1. Find slope: (${y2} - ${y1}) / (${x2} - ${x1}) = ${m}.\n2. Find y-intercept (b) using y = mx + b:\n   ${y1} = ${m}(${x1}) + b\n   ${y1} = ${m*x1} + b -> b = ${b}.\n3. Equation: ${correctEq}`
        };
    }

    // Q7: Parallel to y = -x - 5 (MC)
    function genQ7() {
        let m = -1; 
        let b = randInt(-9, 9);
        let x1 = randInt(2, 9);
        let y1 = randInt(-5, 5);
        
        let eqGiven = `y = -x ${b >= 0 ? '+' : '-'} ${Math.abs(b)}`;
        
        let signY = y1 < 0 ? '+' : '-';
        let absY = Math.abs(y1);
        let signX = x1 < 0 ? '+' : '-';
        let absX = Math.abs(x1);

        let correct = `y ${signY} ${absY} = -(x ${signX} ${absX})`;
        let wrong1 = `y ${signY} ${absY} = (x ${signX} ${absX})`; 
        let wrong2 = `y ${signY == '+'?'-':'+'} ${absY} = -(x ${signX} ${absX})`; 
        let wrong3 = `y ${signY} ${absY} = -(x ${signX == '+'?'-':'+'} ${absX})`;

        let options = [correct, wrong1, wrong2, wrong3];
        options = options.sort(() => Math.random() - 0.5);

        return {
            type: 'mc',
            text: `Find the equation of a line <b>parallel</b> to <span class="math-text">${eqGiven}</span> that passes through <span class="math-text">${formatCoord(x1, y1)}</span>.`,
            options: options,
            correctAnswer: correct,
            solution: `1. Parallel slope is same: m = -1.\n2. Point-Slope form: y - y1 = m(x - x1).\n3. y - (${y1}) = -1(x - (${x1}))\n   ${correct}`
        };
    }

    // Q8: Perpendicular to Ax - By = C (MC)
    function genQ8() {
        let A = 2; 
        let B = 3;
        let C = randInt(10, 20);
        let x1 = randInt(2, 8);
        let y1 = randInt(2, 8);
        
        let perpSlopeM = -3/2;
        let perpSlopeStr = "-3/2";
        
        x1 = x1 * 2; // ensure even
        
        let bVal = y1 - (perpSlopeM * x1);
        
        let correct = `y = ${perpSlopeStr}x ${bVal >= 0 ? '+' : '-'} ${Math.abs(bVal)}`;
        let wrong1 = `y = 2/3x ${bVal >= 0 ? '+' : '-'} ${Math.abs(bVal)}`; 
        let wrong2 = `y = ${perpSlopeStr}x ${bVal >= 0 ? '-' : '+'} ${Math.abs(bVal)}`; 
        let wrong3 = `y = 3/2x ${bVal >= 0 ? '+' : '-'} ${Math.abs(bVal)}`; 

        let options = [correct, wrong1, wrong2, wrong3];
        options = options.sort(() => Math.random() - 0.5);

        return {
            type: 'mc',
            text: `Find the equation of a line <b>perpendicular</b> to <span class="math-text">2x - 3y = ${C}</span> that passes through the point <span class="math-text">${formatCoord(x1, y1)}</span>.`,
            options: options,
            correctAnswer: correct,
            solution: `1. Find slope of given line: 2x - 3y = ${C} -> -3y = -2x... -> y = 2/3x... Slope = 2/3.\n2. Perpendicular slope is negative reciprocal: -3/2.\n3. Find b using (${x1}, ${y1}):\n   ${y1} = (-3/2)(${x1}) + b\n   ${y1} = -${(3*x1)/2} + b\n   b = ${bVal}.\n4. Equation: ${correct}`
        };
    }

    // --- MAIN ENGINE ---

    function generateQuestions() {
        questions = [
            genQ1(), genQ2(), genQ3(), genQ4(), genQ5(), genQ6(), genQ7(), genQ8()
        ];
    }

    function startNewQuiz() {
        generateQuestions();
        currentQIndex = 0;
        score = 0;
        document.getElementById('total-q').innerText = questions.length;
        document.getElementById('score-correct').innerText = "0";
        document.getElementById('summary-area').classList.add('hidden');
        document.getElementById('quiz-area').classList.remove('hidden');
        renderQuestion();
    }

    function renderQuestion() {
        let q = questions[currentQIndex];
        document.getElementById('q-num').innerText = currentQIndex + 1;
        document.getElementById('question-text').innerHTML = q.text;
        document.getElementById('feedback-area').style.display = 'none';
        document.getElementById('feedback-area').className = 'feedback'; // reset classes
        document.getElementById('submit-btn').classList.remove('hidden');
        document.getElementById('next-btn').classList.add('hidden');
        
        let container = document.getElementById('input-container');
        container.innerHTML = '';

        if (q.type === 'text') {
            let input = document.createElement('input');
            input.type = 'text';
            input.id = 'user-ans';
            input.placeholder = 'Type your answer...';
            input.autocomplete = 'off';
            container.appendChild(input);
        } else if (q.type === 'mc') {
            selectedMCOption = null;
            q.options.forEach(opt => {
                let div = document.createElement('div');
                div.className = 'mc-option';
                div.innerText = opt;
                div.onclick = function() {
                    document.querySelectorAll('.mc-option').forEach(el => el.classList.remove('selected'));
                    div.classList.add('selected');
                    selectedMCOption = opt;
                };
                container.appendChild(div);
            });
        }
    }

    function checkAnswer() {
        let q = questions[currentQIndex];
        let isCorrect = false;
        let userVal = "";

        if (q.type === 'text') {
            let rawInput = document.getElementById('user-ans').value;
            // Normalize: remove spaces, handle double signs if user typed them
            userVal = rawInput.replace(/\s/g, '').replace(/\-\-/g, '+').replace(/\+\-/g, '-');
            // Normalize correct answer too
            let correctNorm = q.correctAnswer.replace(/\s/g, '');
            
            if (userVal === correctNorm) isCorrect = true;
        } else {
            if (!selectedMCOption) {
                alert("Please select an option.");
                return;
            }
            if (selectedMCOption === q.correctAnswer) isCorrect = true;
        }

        let feedbackTitle = document.getElementById('feedback-title');
        let feedbackArea = document.getElementById('feedback-area');
        let solutionText = document.getElementById('solution-text');

        feedbackArea.style.display = 'block';
        if (isCorrect) {
            score++;
            document.getElementById('score-correct').innerText = score;
            feedbackArea.classList.add('correct');
            feedbackTitle.innerText = "Correct! ✅";
        } else {
            feedbackArea.classList.add('incorrect');
            feedbackTitle.innerText = "Incorrect ❌";
        }

        solutionText.innerText = q.solution;

        document.getElementById('submit-btn').classList.add('hidden');
        document.getElementById('next-btn').classList.remove('hidden');
    }

    function nextQuestion() {
        currentQIndex++;
        if (currentQIndex < questions.length) {
            renderQuestion();
        } else {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('summary-area').classList.remove('hidden');
            document.getElementById('final-score').innerText = `${score} / ${questions.length}`;
        }
    }

    // Initialize on load
    startNewQuiz();

</script>
</body>
</html>
