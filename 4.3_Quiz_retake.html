<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Models and Applications Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .quiz-container {
            transition: all 0.3s ease-in-out;
        }
        .result-item.correct {
            background-color: #f0fdf4;
            border-left-color: #22c55e;
        }
        .result-item.incorrect {
            background-color: #fef2f2;
            border-left-color: #ef4444;
        }
        .question-prefix {
            font-weight: 500;
            flex-shrink: 0;
        }
        canvas {
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            max-width: 100%;
            height: auto;
        }
        .data-table {
            border-collapse: collapse;
            width: 100%;
            max-width: 250px;
            margin: 1rem auto;
        }
        .data-table th, .data-table td {
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-lg w-full max-w-5xl quiz-container">
        <div class="p-8 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800">Linear Models & Applications</h1>
            <p class="text-gray-600 mt-2">Generate a new quiz anytime.</p>
        </div>

        <div id="quizContainer" class="p-8">
            <!-- The quiz form will be dynamically generated and inserted here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Quiz Results</h2>
            <div id="score" class="text-xl mb-6 font-semibold"></div>
            <div id="detailedResults" class="space-y-4"></div>
             <div class="mt-8 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="retakeQuizBtn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700">Try This Quiz Again</button>
                <button id="generateNewBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700">Generate New Quiz</button>
            </div>
        </div>
    </main>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        const resultsSection = document.getElementById('resultsSection');
        const scoreElement = document.getElementById('score');
        const detailedResultsElement = document.getElementById('detailedResults');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const generateNewBtn = document.getElementById('generateNewBtn');

        let currentQuestions = [];

        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);

        const contexts = {
            growth: [
                { thing: 'sunflower', y_axis: 'Height (inches)', x_axis: 'Time (weeks)' },
                { thing: 'savings account', y_axis: 'Balance ($)', x_axis: 'Time (months)' },
                { thing: 'beanstalk', y_axis: 'Height (feet)', x_axis: 'Time (days)' }
            ],
            depletion: [
                { thing: 'car with gas', y_axis: 'Gallons Remaining', x_axis: 'Hours Driven' },
                { thing: 'phone battery', y_axis: 'Battery (%)', x_axis: 'Hours of Use' },
                { thing: 'water tank', y_axis: 'Water Level (ft)', x_axis: 'Time (minutes)' }
            ],
            cost: [
                { thing: 'phone manufacturing', p: 'phones', C: 'Total Cost ($)', item: 'phone' },
                { thing: 'studio rental', p: 'hours', C: 'Total Fee ($)', item: 'hour' },
                { thing: 't-shirt printing', p: 'shirts', C: 'Total Price ($)', item: 'shirt' }
            ]
        };

        function generateQuizData() {
            let questions = [];

            // Q1: Slope from graph in context
            const ctx1 = shuffle(contexts.growth)[0];
            const m1 = getRandomInt(4, 8); const b1 = getRandomInt(5, 15);
            questions.push({ type: 'graph-slope', id: 'q1',
                title: `At the beginning of spring, Makayla planted a small ${ctx1.thing}. The graph below represents the ${ctx1.thing}'s ${ctx1.y_axis.toLowerCase()} after x ${ctx1.x_axis.toLowerCase()}. What does the slope of the line represent?`,
                data: { m: m1, b: b1, ...ctx1 },
                answer: m1.toString()
            });

            // Q2: Interpret equation components
            const m2 = getRandomInt(25, 50) / 100; const b2 = getRandomInt(20, 40);
            questions.push({ type: 'interpret-equation', id: 'q2',
                title: `There's a roughly linear relationship between the number of times a species of cricket will chirp in one minute and the temperature outside. For a certain type of cricket, this relationship can be expressed using the formula T = ${b2} + ${m2}c, where T represents the temperature in degrees Fahrenheit and c represents the number of times the cricket chirps in one minute. What could the number ${m2} represent in the equation?`,
                answer: 'The increase in temperature for each additional chirp per minute.'
            });
            
            // Q3: Equation and y-intercept from graph
            const ctx3 = shuffle(contexts.depletion)[0];
            const m3 = -getRandomInt(1, 4); const b3 = getRandomInt(8, 12);
            questions.push({ type: 'graph-equation-intercept', id: 'q3',
                title: `Serenity filled up her car with gas before embarking on a road trip across the country. Let G represent the number of gallons of gas remaining in her gas tank after driving for t hours. A graph of G is shown below. Write an equation for G then state the y-intercept of the graph and determine its interpretation in the context of the problem.`,
                data: { m: m3, b: b3, ...ctx3 },
                answers: {
                    equation: `G=${m3}t+${b3}`,
                    y_intercept: `(0,${b3})`,
                    interpretation: `The initial amount of gas in the tank.`
                }
            });

            // Q4: Cost from table
            const ctx4 = shuffle(contexts.cost)[0];
            const m4 = getRandomInt(75, 125); const b4 = getRandomInt(200, 400);
            const table4 = [1, 5, 8].map(p => ({ p, C: m4 * p + b4 }));
            const final_p = (getRandomInt(15, 20) / 2).toFixed(1);
            questions.push({ type: 'table-cost', id: 'q4',
                title: `${ctx4.thing.charAt(0).toUpperCase() + ctx4.thing.slice(1)}.`,
                text: `Determine how much Janelys would need to pay in fees if she needed to use the studio for ${final_p} ${ctx4.p}.`,
                data: { table: table4, p_label: ctx4.p, C_label: ctx4.C },
                answer: (m4 * final_p + b4).toString()
            });
            
            // Q5: Interpret y-intercept from equation
            const m5 = -getRandomInt(25, 35); const b5 = getRandomInt(250, 350);
            questions.push({ type: 'interpret-intercept', id: 'q5',
                title: `Charlotte is going to drive from her house to City A without stopping. An equation that determines Charlotte's distance from City A t hours after leaving her house is D = ${m5}t + ${b5}. What is the y-intercept of the equation and what is its interpretation in the context of the problem?`,
                answers: {
                    y_intercept: b5.toString(),
                    interpretation: `Charlotte's initial distance from City A.`
                }
            });

            // Q6: Write equation from word problem
            const start_depth = getRandomInt(12, 18);
            const hours = getRandomInt(3, 5);
            const end_depth = start_depth - getRandomInt(2, 5);
            const m6 = (end_depth - start_depth) / hours;
            questions.push({ type: 'word-problem-equation', id: 'q6',
                title: `At the end of a snow storm, Emily saw there was a lot of snow on her front lawn. The temperature increased and the snow began to melt at a steady rate. There was a depth of ${start_depth} inches of snow on the lawn when the storm ended and after ${hours} hours, the depth of snow was down to ${end_depth} inches. Write an equation for S, in terms of t, representing the depth of snow on Emily's lawn, in inches, t hours after the snow stopped falling.`,
                answer: `S=${m6}t+${start_depth}`
            });

            currentQuestions = questions;
        }

        function drawGraph(canvasId, graphData) {
            const { m, b, x_axis, y_axis } = graphData;
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const { width, height, scaleX, scaleY, originX, originY, pad } = { width: 400, height: 300, scaleX: 30, scaleY: 5, originX: 40, originY: 260, pad: 40 };
            canvas.width = width; canvas.height = height;
            
            ctx.clearRect(0, 0, width, height);

            // Draw grid
            ctx.strokeStyle = '#e5e7eb'; ctx.lineWidth = 1;
            for (let i = 1; i <= 12; i++) { // Vertical lines
                const x = originX + i * scaleX;
                ctx.beginPath(); ctx.moveTo(x, pad); ctx.lineTo(x, originY); ctx.stroke();
            }
             for (let i = 1; i <= 12; i++) { // Horizontal lines
                const y = originY - i * 2 * scaleY; // y-axis scale is different
                ctx.beginPath(); ctx.moveTo(originX, y); ctx.lineTo(width-pad, y); ctx.stroke();
            }

            // Draw axes
            ctx.strokeStyle = '#374151'; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(originX, pad); ctx.lineTo(originX, originY); ctx.lineTo(width - pad, originY); ctx.stroke();

            // Draw labels and ticks
            ctx.fillStyle = '#374151'; ctx.font = '12px Inter'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            // X-axis
            ctx.fillText(x_axis, originX + (width-pad-originX)/2, originY + 25);
            for(let i=0; i <= 12; i++) {
                if(i>0) { ctx.beginPath(); ctx.moveTo(originX + i*scaleX, originY-3); ctx.lineTo(originX + i*scaleX, originY+3); ctx.stroke(); }
                if(i % 2 === 0) ctx.fillText(i, originX + i*scaleX, originY + 15);
            }
            // Y-axis
            ctx.save(); ctx.translate(15, originY - (originY-pad)/2); ctx.rotate(-Math.PI/2); ctx.fillText(y_axis, 0, 0); ctx.restore();
            for(let i=0; i <= 12; i++) {
                 if(i>0) { ctx.beginPath(); ctx.moveTo(originX-3, originY - i*2*scaleY); ctx.lineTo(originX+3, originY - i*2*scaleY); ctx.stroke(); }
                 if(i>0 && i % 2 === 0) ctx.fillText(i*2, originX - 20, originY - i*2*scaleY);
            }

            // Draw the line
            ctx.strokeStyle = '#3b82f6'; ctx.lineWidth = 2;
            ctx.beginPath();
            const x1 = 0; const y1 = b;
            ctx.moveTo(originX + x1 * scaleX, originY - y1 * scaleY * (m > 0 ? 1 : 2));
            const x2 = 12; const y2 = m*x2 + b;
            ctx.lineTo(originX + x2 * scaleX, originY - y2 * scaleY * (m > 0 ? 1 : 2) );
            ctx.stroke();
        }
        
        function renderQuizForm() {
            let html = '<form id="quizForm">';
            currentQuestions.forEach(q => {
                html += `<div class="mb-10"><h2 class="text-xl font-semibold text-gray-700 mb-4">${q.id.slice(1)}. ${q.title}</h2>`;
                if(q.type === 'graph-slope') {
                    html += `<div class="flex flex-col items-center gap-4">
                                <canvas id="${q.id}_canvas" class="max-w-md"></canvas>
                                <div><label>Slope: </label><input id="${q.id}" class="p-1 border rounded-lg w-24"></div>
                             </div>`;
                } else if (q.type === 'interpret-equation') {
                    html += `<textarea id="${q.id}" class="w-full p-2 border rounded-lg" rows="2" placeholder="Explain the meaning..."></textarea>`;
                } else if (q.type === 'graph-equation-intercept') {
                    html += `<div class="flex flex-col items-center gap-4">
                                <canvas id="${q.id}_canvas" class="max-w-md"></canvas>
                                <div class="space-y-2 text-center">
                                    <div><label>Equation: </label><input id="${q.id}_eq" class="p-1 border rounded-lg" placeholder="G=mt+b"></div>
                                    <div><label>y-intercept: </label><input id="${q.id}_yint" class="p-1 border rounded-lg" placeholder="(0, y)"></div>
                                    <div><label>Interpretation: </label><textarea id="${q.id}_interp" class="w-full p-2 border rounded-lg" rows="1"></textarea></div>
                                </div>
                             </div>`;
                } else if (q.type === 'table-cost') {
                    html += `<div class="flex flex-col items-center gap-4">
                                <table class="data-table"><thead><tr><th>${q.data.p_label}</th><th>${q.data.C_label}</th></tr></thead><tbody>
                                ${q.data.table.map(row => `<tr><td>${row.p}</td><td>${row.C}</td></tr>`).join('')}</tbody></table>
                                <p>${q.text}</p>
                                <div><label>Cost: $</label><input type="number" step="0.01" id="${q.id}" class="p-1 border rounded-lg w-32"></div>
                             </div>`;
                } else if (q.type === 'interpret-intercept') {
                     html += `<div class="space-y-2">
                                <div><label>The y-intercept of the function is </label><input id="${q.id}_yint" class="p-1 border rounded-lg w-20"></div>
                                <div><label>which represents </label><textarea id="${q.id}_interp" class="w-full p-2 border rounded-lg" rows="1"></textarea></div>
                              </div>`;
                } else if (q.type === 'word-problem-equation') {
                    html += `<input type="text" id="${q.id}" class="w-full p-2 border rounded-lg" placeholder="S = mt + b">`;
                }
                html += `</div>`;
            });
            html += `<div class="mt-10 text-center"><button type="submit" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg">Grade My Quiz</button></div></form>`;
            quizContainer.innerHTML = html;
            
            currentQuestions.filter(q => q.type.includes('graph')).forEach(q => drawGraph(`${q.id}_canvas`, q.data));
            
            document.getElementById('quizForm').addEventListener('submit', gradeQuiz);
        }
        
        const normalize = str => {
            let s = str.replace(/\s+/g, '').toLowerCase();
            // Handle implicit -1 coefficient, e.g., s=-t+16 -> s=-1t+16
            const parts = s.split('=');
            if (parts.length === 2) {
                if (parts[1].startsWith('-') && isNaN(parseInt(parts[1][1]))) {
                    parts[1] = '-1' + parts[1].substring(1);
                    s = parts.join('=');
                }
            }
            return s;
        };

        function gradeQuiz(event) {
            event.preventDefault();
            let score = 0, total = 0, resultsHTML = '';
            
            currentQuestions.forEach(q => {
                let isCorrect, userInput;
                switch(q.type) {
                    case 'graph-slope':
                        total++;
                        userInput = document.getElementById(q.id).value.trim();
                        isCorrect = userInput === q.answer;
                        if(isCorrect) score++;
                        resultsHTML += `<div class="result-item border-l-4 p-4 ${isCorrect?'c':'inc'}orrect"><p>Q${q.id.slice(1)} Slope: Your answer ${userInput}. Correct: ${q.answer}</p></div>`;
                        break;
                    case 'interpret-equation':
                        total++;
                        userInput = document.getElementById(q.id).value.toLowerCase();
                        isCorrect = userInput.includes('increase') && (userInput.includes('temp') || userInput.includes('degree')) && userInput.includes('chirp');
                        if(isCorrect) score++;
                        resultsHTML += `<div class="result-item border-l-4 p-4 ${isCorrect?'c':'inc'}orrect"><p>Q${q.id.slice(1)} Interpretation: Your answer was graded for keywords. Correct: ${q.answer}</p></div>`;
                        break;
                    case 'graph-equation-intercept':
                        total += 3;
                        const eqU = document.getElementById(`${q.id}_eq`).value;
                        const yintU = document.getElementById(`${q.id}_yint`).value;
                        const interpU = document.getElementById(`${q.id}_interp`).value.toLowerCase();
                        const eqC = normalize(eqU) === normalize(q.answers.equation);
                        const yintC = normalize(yintU) === normalize(q.answers.y_intercept);
                        const interpC = interpU.includes('initial') || interpU.includes('start');
                        if(eqC) score++; if(yintC) score++; if(interpC) score++;
                        resultsHTML += `<div class="result-item border-l-4 p-4"><p>Q${q.id.slice(1)}:</p>
                            <p class="${eqC?'':'text-red-500'}">Eq: ${eqU} (Correct: ${q.answers.equation})</p>
                            <p class="${yintC?'':'text-red-500'}">Y-int: ${yintU} (Correct: ${q.answers.y_intercept})</p>
                            <p class="${interpC?'':'text-red-500'}">Interp: ${interpU} (Keywords: initial/start)</p></div>`;
                        break;
                    case 'table-cost':
                        total++;
                        userInput = document.getElementById(q.id).value;
                        isCorrect = userInput === q.answer;
                        if(isCorrect) score++;
                         resultsHTML += `<div class="result-item border-l-4 p-4 ${isCorrect?'c':'inc'}orrect"><p>Q${q.id.slice(1)} Cost: Your answer ${userInput}. Correct: ${q.answer}</p></div>`;
                        break;
                    case 'interpret-intercept':
                        total += 2;
                        const yintU2 = document.getElementById(`${q.id}_yint`).value;
                        const interpU2 = document.getElementById(`${q.id}_interp`).value.toLowerCase();
                        const yintC2 = yintU2 === q.answers.y_intercept;
                        const interpC2 = interpU2.includes('initial') || interpU2.includes('start') || interpU2.includes('beginning');
                        if(yintC2) score++; if(interpC2) score++;
                        resultsHTML += `<div class="result-item border-l-4 p-4"><p>Q${q.id.slice(1)}:</p>
                            <p class="${yintC2?'':'text-red-500'}">Y-int: ${yintU2} (Correct: ${q.answers.y_intercept})</p>
                            <p class="${interpC2?'':'text-red-500'}">Interp: ${interpU2} (Keywords: initial/start/beginning)</p></div>`;
                        break;
                    case 'word-problem-equation':
                        total++;
                        userInput = document.getElementById(q.id).value;
                        isCorrect = normalize(userInput) === normalize(q.answer);
                        if(isCorrect) score++;
                         resultsHTML += `<div class="result-item border-l-4 p-4 ${isCorrect?'c':'inc'}orrect"><p>Q${q.id.slice(1)} Equation: Your answer ${userInput}. Correct: ${q.answer}</p></div>`;
                        break;
                }
            });
            
            const percentage = total > 0 ? Math.round((score / total) * 100) : 0;
            let scoreColor = percentage >= 80 ? 'text-green-600' : (percentage >= 60 ? 'text-yellow-600' : 'text-red-600');
            scoreElement.innerHTML = `Your Score: <span class="${scoreColor}">${score} out of ${total} (${percentage}%)</span>`;
            detailedResultsElement.innerHTML = resultsHTML;
            quizContainer.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }
        
        retakeQuizBtn.addEventListener('click', () => {
            renderQuizForm();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });
        generateNewBtn.addEventListener('click', () => {
            generateQuizData();
            renderQuizForm();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });
        document.addEventListener('DOMContentLoaded', () => {
             generateQuizData();
             renderQuizForm();
        });
    </script>
</body>
</html>


