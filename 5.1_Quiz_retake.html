<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Systems of Linear Equations Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        canvas {
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }
        .radio-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            transition: all 0.2s;
        }
        .radio-label:has(input:checked) {
            background-color: #eff6ff;
            border-color: #3b82f6;
        }
        .analysis-choice-label {
             display: flex;
             align-items: center;
             cursor: pointer;
             padding: 0.5rem 1rem;
             border-radius: 9999px;
             border: 1px solid #d1d5db;
             transition: all 0.2s;
             font-size: 0.875rem;
        }
        .analysis-choice-label:has(input:checked) {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .system-brace {
            font-size: 4rem;
            font-family: serif;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-2xl shadow-lg w-full max-w-6xl">
        <div class="p-8 border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800">Systems of Linear Equations</h1>
            <p class="text-gray-600 mt-2">Generate a new quiz anytime.</p>
        </div>

        <div id="quizContainer" class="p-8">
            <!-- The quiz form will be dynamically generated and inserted here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Quiz Results</h2>
            <div id="score" class="text-xl mb-6 font-semibold"></div>
            <div id="detailedResults" class="space-y-4"></div>
             <div class="mt-8 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="retakeQuizBtn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700">Try This Quiz Again</button>
                <button id="generateNewBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700">Generate New Quiz</button>
            </div>
        </div>
    </main>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        const resultsSection = document.getElementById('resultsSection');
        const scoreElement = document.getElementById('score');
        const detailedResultsElement = document.getElementById('detailedResults');
        const retakeQuizBtn = document.getElementById('retakeQuizBtn');
        const generateNewBtn = document.getElementById('generateNewBtn');

        let currentQuestions = [];

        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
        
        function createLine(form = 'si') {
            const m = getRandomInt(-3, 3) || 1;
            const b = getRandomInt(-5, 5);
            if (form === 'si') {
                return { m, b };
            }
            // Standard Form Ax+By=C
            const B = getRandomInt(1, 4);
            const A = -m * B;
            const C = b * B;
            return { A, B, C, m, b };
        }
        
        function generateQuizData() {
            let questions = [];

            // Q1 & Q2: Match graph from SI & Standard
            const line1a = createLine(); let line1b;
            do { line1b = createLine(); } while (line1a.m === line1b.m);
            questions.push({ type: 'match-graph', id: 'q1', title: 'Identify the graph of the system of equation.',
                systemText: `{ y = ${line1a.m}x ${line1a.b>=0?'+':'-'} ${Math.abs(line1a.b)} <br> y = ${line1b.m}x ${line1b.b>=0?'+':'-'} ${Math.abs(line1b.b)} }`,
                options: shuffle([ [line1a, line1b], [{...line1a, b: -line1a.b || 1}, line1b], [line1a, {...line1b, m: -line1b.m}], [{m: line1b.m, b: line1a.b}, {m: line1a.m, b: line1b.b}] ]),
                answer: [line1a, line1b]
            });
            const line2a = createLine('std'); let line2b;
            do { line2b = createLine('std'); } while (line2a.m === line2b.m);
            questions.push({ type: 'match-graph', id: 'q2', title: 'Identify the graph of the system of equation.',
                systemText: `{ ${line2a.A}x + ${line2a.B}y = ${line2a.C} <br> ${line2b.A}x + ${line2b.B}y = ${line2b.C} }`,
                options: shuffle([ [line2a, line2b], [{...line2a, b: -line2a.b || 1}, line2b], [line2a, {...line2b, m: -line2b.m}], [{...line2a, m: -line2a.m}, {...line2b, b: -line2b.b}] ]),
                answer: [line2a, line2b]
            });

            // Q3, Q4, Q5: Analysis
            const line3a = createLine('std'); let line3b; // One Solution
            do { line3b = createLine('std'); } while (line3a.m === line3b.m);
            questions.push({ type: 'analysis', id: 'q3', system: [line3a, line3b], answers: { slopes: 'different', intercepts: 'different', lines: 'intersecting', solutions: 'one' }});
            
            const line4a = createLine('std'); // No Solution
            const line4b = {...line4a, C: line4a.C + line4a.B, b: line4a.b + 1 };
            questions.push({ type: 'analysis', id: 'q4', system: [line4a, line4b], answers: { slopes: 'same', intercepts: 'different', lines: 'parallel', solutions: 'none' }});

            const line5a = createLine('std'); const k = getRandomInt(2,3); // Infinite Solutions
            const line5b = { A: line5a.A * k, B: line5a.B * k, C: line5a.C * k, m: line5a.m, b: line5a.b };
            questions.push({ type: 'analysis', id: 'q5', system: [line5a, line5b], answers: { slopes: 'same', intercepts: 'same', lines: 'coinciding', solutions: 'infinite' }});

            currentQuestions = questions;
        }

        function drawSystemGraph(canvasId, systemData) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const { width, height, scale, originX, originY } = { width: 200, height: 200, scale: 20, originX: 100, originY: 100 };
            canvas.width = width; canvas.height = height;
            ctx.clearRect(0, 0, width, height);
            ctx.strokeStyle = '#d1d5db'; ctx.lineWidth = 1;
            for (let i = scale; i < width; i+=scale) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, height); ctx.stroke(); }
            for (let i = scale; i < height; i+=scale) { ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(width, i); ctx.stroke(); }
            ctx.strokeStyle = '#374151'; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(0, originY); ctx.lineTo(width, originY); ctx.moveTo(originX, 0); ctx.lineTo(originX, height); ctx.stroke();
            const colors = ['#dc2626', '#2563eb'];
            systemData.forEach((line, index) => {
                const { m, b } = line;
                ctx.strokeStyle = colors[index]; ctx.lineWidth = 2;
                ctx.beginPath();
                const x_min = -5; const y_min = m * x_min + b;
                ctx.moveTo(originX + x_min * scale, originY - y_min * scale);
                const x_max = 5; const y_max = m * x_max + b;
                ctx.lineTo(originX + x_max * scale, originY - y_max * scale);
                ctx.stroke();
            });
        }
        
        function renderQuizForm() {
            let html = '<form id="quizForm">';
            let analysisCount = 0;
            currentQuestions.forEach(q => {
                let questionNumber;
                if(q.type === 'match-graph') questionNumber = q.id.slice(1);
                else { analysisCount++; questionNumber = 2 + analysisCount; }

                html += `<div class="mb-12"><h2 class="text-xl font-semibold text-gray-700 mb-6">${questionNumber}. ${q.title || 'Using an analysis of slopes and y-intercepts to determine the number of solutions for each system.'}</h2>`;
                if (q.type === 'match-graph') {
                    html += `<div class="flex items-center justify-center mb-4">
                                <span class="system-brace">{</span><div class="text-lg font-mono">${q.systemText}</div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">`;
                    q.options.forEach((opt, i) => {
                        html += `<label class="radio-label">
                                <p class="font-bold mb-2">${String.fromCharCode(65+i)}</p>
                                <canvas id="${q.id}_opt${i}_canvas"></canvas>
                                <input type="radio" name="${q.id}" value="${i}" class="mt-2 h-5 w-5">
                                </label>`;
                    });
                    html += `</div>`;
                } else if (q.type === 'analysis') {
                    const analysisOptions = {
                        slopes: ['same', 'different'],
                        intercepts: ['same', 'different'],
                        lines: ['intersecting', 'parallel', 'coinciding'],
                        solutions: ['one', 'none', 'infinite']
                    };
                     html += `<div class="flex flex-col items-center">
                                <div class="flex items-center justify-center mb-4">
                                    <span class="system-brace">{</span><div class="text-lg font-mono">${q.system[0].A}x + ${q.system[0].B}y = ${q.system[0].C} <br> ${q.system[1].A}x + ${q.system[1].B}y = ${q.system[1].C}</div>
                                </div>
                                <div class="w-full max-w-2xl grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">`;
                    Object.entries(analysisOptions).forEach(([key, opts]) => {
                        const title = key.charAt(0).toUpperCase() + key.slice(1).replace('_', ' ');
                        html += `<div><p class="font-medium mb-2 text-center md:text-left">${title}:</p><div class="flex gap-2 justify-center md:justify-start">`
                        opts.forEach(opt => {
                             html += `<label class="analysis-choice-label"><input type="radio" name="${q.id}_${key}" value="${opt}" class="sr-only"> ${opt.charAt(0).toUpperCase() + opt.slice(1)}</label>`;
                        });
                        html += `</div></div>`;
                    });
                    html += `</div></div>`;
                }
                html += `</div>`;
            });
            html += `<div class="mt-10 text-center"><button type="submit" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg">Grade My Quiz</button></div></form>`;
            quizContainer.innerHTML = html;
            
            currentQuestions.filter(q => q.type === 'match-graph').forEach(q => q.options.forEach((opt, i) => drawSystemGraph(`${q.id}_opt${i}_canvas`, opt)));
            
            document.getElementById('quizForm').addEventListener('submit', gradeQuiz);
        }

        function gradeQuiz(event) {
            event.preventDefault();
            let score = 0, total = 0, resultsHTML = '';
            
            currentQuestions.forEach(q => {
                if(q.type === 'match-graph') {
                    total++;
                    const userChoiceIndex = document.querySelector(`input[name="${q.id}"]:checked`)?.value;
                    const correctIndex = q.options.findIndex(opt => JSON.stringify(opt) === JSON.stringify(q.answer));
                    const isCorrect = userChoiceIndex == correctIndex;
                    if(isCorrect) score++;
                     resultsHTML += `<div class="p-4 border-l-4 ${isCorrect?'border-green-500 bg-green-50':'border-red-500 bg-red-50'}"><p>Question ${q.id.slice(1)}: Your selection was ${isCorrect?'correct':'incorrect'}.</p></div>`;
                } else if (q.type === 'analysis') {
                    total += 4;
                    const userAnswers = {
                        slopes: document.querySelector(`input[name="${q.id}_slopes"]:checked`)?.value,
                        intercepts: document.querySelector(`input[name="${q.id}_intercepts"]:checked`)?.value,
                        lines: document.querySelector(`input[name="${q.id}_lines"]:checked`)?.value,
                        solutions: document.querySelector(`input[name="${q.id}_solutions"]:checked`)?.value,
                    };

                    let questionResultHTML = `<div class="p-4 border-l-4"><p class="font-bold">Analysis for System ${q.id.slice(1)}:</p>`;
                    Object.entries(userAnswers).forEach(([key, val]) => {
                        const isCorrect = val === q.answers[key];
                        if (isCorrect) score++;
                        const title = key.charAt(0).toUpperCase() + key.slice(1);
                        questionResultHTML += `<p class="${isCorrect?'':'text-red-500'}">${title}: You chose <strong>${val || 'none'}</strong>. ${!isCorrect ? `(Correct: ${q.answers[key]})` : ''}</p>`;
                    });
                    questionResultHTML += `</div>`;
                    resultsHTML += questionResultHTML;
                }
            });
            
            const percentage = total > 0 ? Math.round((score / total) * 100) : 0;
            let scoreColor = percentage >= 80 ? 'text-green-600' : (percentage >= 60 ? 'text-yellow-600' : 'text-red-600');
            scoreElement.innerHTML = `Your Score: <span class="${scoreColor}">${score} out of ${total} (${percentage}%)</span>`;
            detailedResultsElement.innerHTML = resultsHTML;
            quizContainer.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }
        
        retakeQuizBtn.addEventListener('click', () => {
            renderQuizForm();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });
        generateNewBtn.addEventListener('click', () => {
            generateQuizData();
            renderQuizForm();
            resultsSection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
        });
        document.addEventListener('DOMContentLoaded', () => {
             generateQuizData();
             renderQuizForm();
        });
    </script>
</body>
</html>

